var CricBase=angular.module("CricBase",[]).constant("Colors",{"#7bd148":"Green","#add8e6":"LightBlue","#7ae7bf":"LightGreen","#fbd75b":"Yellow","#ffb878":"Orange","#ff887c":"Red","#e1e1e1":"Gray"}).constant("TradeColors",{EL:"#4572A7",HV:"#AA4643",RF:"#89A54E",PL:"#80699B",GN:"#3D96AE"}).run(["ApplicationSettingsService",function(h){h.getSettings().then(function(f){console.log("Application settings was successfully loaded.")},function(){console.log("We couldn't load the application settings.")})}]),
Cric=angular.module("Cric",["CricBase"]).config(["$routeProvider","$locationProvider","$compileProvider",function(h,f,a){h.when("/home/dashboard",{action:"home.dashboard.grid"}).when("/home/dashboard/manager",{action:"home.dashboard.manager"}).when("/home/map",{redirectTo:"/home/map/toc"}).when("/home/map/toc",{action:"home.map.toc"}).when("/home/map/info",{action:"home.map.info"}).when("/home/map/tools",{redirectTo:"/home/map/tools/bookmarks"}).when("/home/map/tools/bookmarks",{action:"home.map.tools.bookmarks"}).when("/home/map/tools/query",
{redirectTo:"/home/map/tools/query/attributes"}).when("/home/map/tools/query/attributes",{action:"home.map.tools.query.attributes"}).when("/home/map/tools/query/location",{action:"home.map.tools.query.location"}).when("/home/map/designreview",{action:"home.designreview.workorder"}).when("/home/map/cityengine",{action:"home.cityengine"}).when("/home/workorder",{action:"home.workorder"}).when("/home/chart",{action:"home.chart"}).when("/home/report",{action:"home.report"}).when("/home/userprofile",{action:"home.userprofile"}).when("/home/about",
{action:"home.about"}).when("/logoff",{action:"home.logoff"}).otherwise({redirectTo:"/home/dashboard"});f.html5Mode(!1).hashPrefix("!");a.urlSanitizationWhitelist(/^\s*(https?|javascript):/)}]).run(["MapService",function(h){h.getConfig().then(function(f){console.log("Map config was successfully loaded.")},function(){console.log("We couldn't load the map configuration.")})}]),CricAdmin=angular.module("CricAdmin",["CricBase"]).config(["$routeProvider","$locationProvider",function(h,f){h.when("/admin/users",
{action:"admin.user"}).when("/admin/workordersettings",{action:"admin.workordersetting"}).when("/admin/smtp",{action:"admin.smtp"}).when("/admin/notifications",{action:"admin.notification"}).when("/admin/userprofile",{action:"admin.userprofile"}).when("/admin/about",{action:"admin.about"}).when("/logoff",{action:"admin.logoff"}).otherwise({redirectTo:"/admin/users"});f.html5Mode(!1).hashPrefix("!")}]);(function(h,f){f.controller("admin.AdminCtrl",["$scope","RequestContext",function(a,e){var c=e.getRenderContext("admin");a.subview=c.getNextSection();a.$on("requestContextChanged",function(){c.isChangeRelevant()&&(a.subview=c.getNextSection())})}])})(angular,CricAdmin);(function(h,f){f.controller("admin.NotificationCtrl",["$scope","$q","_","RequestContext","NotificationService",function(a,e,c,d,b){function g(){a.sources=[];a.selectedSources=[];return e.all([b.getSources().then(function(b){a.sources=b;a.selectedSources=c.keys(a.sources)})])}function l(k){a.isDataAvailable=!1;a.pageIndex=1;a.messages=null;a.selectedMessage=null;a.table.isSelectAll=!1;b.getMessages([{name:"sourceid",values:a.selectedSources}],{sortby:a.table.sortby,sortdesc:a.table.sortdesc},k).then(function(b){for(var k=
a,d=a.table.size,g=[],q=[],e=0;e<b.length;e++){var l=c.extend(b[e],{_number:e+1,_selected:!1});q.length>=d&&(g.push(q),q=[]);q.push(l)}q.length<=d&&g.push(q);k.messages=g;a.selectedMessage=h.copy(a.messages[0][0]);a.onSourceChanged();a.isDataAvailable=0<b.length;a.isLoading=!1},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't get notifications information. Try refreshing your browser.")})}a.isLoading=!0;a.isDataAvailable=!1;a.pageIndex=1;a.users=null;a.selectedMessage=
null;a.sources=[];a.selectedSources=[];a.selectedAttribute=null;a.table={sizes:[5,10,15],size:5,isSelectAll:!1,selectedCount:0,hasSelected:!1,sortby:"sourcename",sortdesc:!1,selectedAttribute:null};a.onPageSizeChanged=function(){l(!0)};a.onSlide=function(b){a.pageIndex="prev"==b?1==a.pageIndex?a.messages.length:a.pageIndex-1:a.pageIndex==a.messages.length?1:a.pageIndex+1};a.onSelectMessage=function(b){a.selectedMessage=h.copy(b);a.onSourceChanged()};a.onCheckAll=function(){a.table.selectedCount=0;
c.forEach(a.messages,function(b){c.forEach(b,function(b){b._selected=a.table.isSelectAll;b._selected&&a.table.selectedCount++})});a.table.hasSelected=0<a.table.selectedCount};a.onCheck=function(b){a.table.isSelectAll=!1;b._selected?a.table.selectedCount++:a.table.selectedCount--;a.table.hasSelected=0<a.table.selectedCount};a.onSearchClick=function(){l()};a.onResetClick=function(){g()};a.sortBy=function(b){a.table.sortby==b?a.table.sortdesc=!a.table.sortdesc:(a.table.sortby=b,a.table.sortdesc=!1);
l(!0)};a.isSortBy=function(b){return b==a.table.sortby?a.table.sortdesc?"sorting_desc":"sorting_asc":"sorting"};a.onSaveClick=function(){b.saveMessage(a.selectedMessage).then(function(b){if(a.selectedMessage.messageid)for(b=0;b<a.messages[a.pageIndex-1].length;b++){if(a.messages[a.pageIndex-1][b].messageid==a.selectedMessage.messageid){a.messages[a.pageIndex-1][b]=h.copy(a.selectedMessage);break}}else l(!0);a.openModalWindow("success","The message has been successfully saved.")},function(){a.openModalWindow("error",
"For some reason we couldn't save the message. Try refreshing your browser.")})};a.onCreateMessageClick=function(){var b=c.keys(a.sources)[0],d=c.keys(a.sources[b].events)[0];a.selectedMessage={sourceid:b,eventid:d,messageid:null}};a.onDeleteClick=function(){b.deleteMessage(a.selectedMessage).then(function(b){l(!0);a.openModalWindow("success","The message has been successfully deleted.")},function(){a.openModalWindow("error","For some reason we couldn't delete the message. Try refreshing your browser.")})};
a.onSourceChanged=function(){var b=a.sources[a.selectedMessage.sourceid].attributes;a.table.selectedAttribute=b[c.keys(b)[0]]};d.setWindowTitle("Administrative - Notifications");(function(){a.isLoading=!0;a.isDataAvailable=!1;g().then(function(a){l()},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't load source dictionary. Try refreshing your browser.")})})()}])})(angular,CricAdmin);(function(h,f){f.controller("admin.SmtpCtrl",["$scope","RequestContext","ApplicationSettingsService",function(a,e,c){function d(b){a.smtp={hostname:b.hostname,port:b.port,username:b.username,password:b.password,ssl:b.ssl}}a.isLoading=!0;a.smtp={};a.onSaveClick=function(){c.setSetting("smtp",a.smtp).then(function(b){d(b);a.openModalWindow("success","SMTP settings has been successfully saved.")},function(){a.openModalWindow("error","For some reason we couldn't save smtp settings. Try refreshing your browser.")})};
e.setWindowTitle("SMTP Settings");(function(){a.isLoading=!0;c.getSetting("smtp").then(function(b){a.isLoading=!1;d(b)},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't get smtp settings. Try refreshing your browser.")})})()}])})(angular,CricAdmin);(function(h,f){f.controller("admin.UserCtrl",["$scope","$q","_","RequestContext","UserService",function(a,e,c,d,b){function g(){a.roles=[];a.selectedRoles=[];return e.all([b.getRoles().then(function(b){a.roles=b;a.selectedRoles=c.keys(a.roles)})])}function l(k){a.isDataAvailable=!1;a.pageIndex=1;a.users=null;a.selectedUser=null;a.table.isSelectAll=!1;b.getUsers([{name:"roles",values:a.selectedRoles},{name:"username",values:""==a.table.username?[]:a.table.username.split(",")},{name:"fullname",values:""==
a.table.fullname?[]:a.table.fullname.split(",")},{name:"email",values:""==a.table.email?[]:a.table.email.split(",")}],{sortby:a.table.sortby,sortdesc:a.table.sortdesc},k).then(function(b){for(var k=a,d=a.table.size,g=[],q=[],e=0;e<b.length;e++){var l=c.extend(b[e],{_number:e+1,_selected:!1});q.length>=d&&(g.push(q),q=[]);q.push(l)}q.length<=d&&g.push(q);k.users=g;a.selectedUser=h.copy(a.users[0][0]);a.isDataAvailable=0<b.length;a.isLoading=!1},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't get users information. Try refreshing your browser.")})}
a.isLoading=!0;a.isDataAvailable=!1;a.pageIndex=1;a.users=null;a.selectedUser=null;a.roles=[];a.selectedRoles=[];a.table={sizes:[5,10,15],size:5,isSelectAll:!1,selectedCount:0,hasSelected:!1,sortby:"username",sortdesc:!1,username:"",fullname:"",email:""};a.onPageSizeChanged=function(){l(!0)};a.onSlide=function(b){a.pageIndex="prev"==b?1==a.pageIndex?a.users.length:a.pageIndex-1:a.pageIndex==a.users.length?1:a.pageIndex+1};a.onSelectUser=function(b){a.selectedUser=h.copy(b)};a.onCheckAll=function(){a.table.selectedCount=
0;c.forEach(a.users,function(b){c.forEach(b,function(b){b._selected=a.table.isSelectAll;b._selected&&a.table.selectedCount++})});a.table.hasSelected=0<a.table.selectedCount};a.onCheck=function(b){a.table.isSelectAll=!1;b._selected?a.table.selectedCount++:a.table.selectedCount--;a.table.hasSelected=0<a.table.selectedCount};a.onSearchClick=function(){l()};a.onResetClick=function(){a.table.username="";a.table.fullname="";a.table.email="";g()};a.sortBy=function(b){a.table.sortby==b?a.table.sortdesc=!a.table.sortdesc:
(a.table.sortby=b,a.table.sortdesc=!1);l(!0)};a.isSortBy=function(b){return b==a.table.sortby?a.table.sortdesc?"sorting_desc":"sorting_asc":"sorting"};a.onSaveClick=function(){b.saveUser(a.selectedUser).then(function(b){if(a.selectedUser.userid)for(b=0;b<a.users[a.pageIndex-1].length;b++){if(a.users[a.pageIndex-1][b].userid==a.selectedUser.userid){a.users[a.pageIndex-1][b]=h.copy(a.selectedUser);break}}else l(!0);a.openModalWindow("success","The user has been successfully saved.")},function(b){406==
b.status?a.openModalWindow("error","User name is not avaliable. Try to enter another name."):a.openModalWindow("error","For some reason we couldn't save the user. Try refreshing your browser.")})};a.onCreateUserClick=function(){a.selectedUser={roles:["User"]}};a.onResetPasswordClick=function(){b.resetPassword(a.selectedUser).then(function(b){l(!0);a.openModalWindow("success","The password has been successfully reset.")},function(){a.openModalWindow("error","For some reason we couldn't reset the password. Try refreshing your browser.")})};
a.onDeleteClick=function(){b.deleteUser(a.selectedUser).then(function(b){l(!0);a.openModalWindow("success","The user has been successfully deleted.")},function(){a.openModalWindow("error","For some reason we couldn't delete the user. Try refreshing your browser.")})};d.setWindowTitle("Administrative - Users");(function(){a.isLoading=!0;a.isDataAvailable=!1;g().then(function(a){l()},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't load dictionaries. Try refreshing your browser.")})})()}])})(angular,
CricAdmin);(function(h,f){f.controller("admin.WorkOrderSettingCtrl",["$scope","Colors","RequestContext","ApplicationSettingsService",function(a,e,c,d){a.isLoading=!0;a.colors=e;a.wocolors={};a.onSaveClick=function(){d.setSetting("colors",a.wocolors).then(function(b){a.wocolors=b;a.openModalWindow("success","Work order settings has been successfully saved.")},function(){a.openModalWindow("error","For some reason we couldn't save work order settings. Try refreshing your browser.")})};c.setWindowTitle("Work Order Settings");
(function(){a.isLoading=!0;d.getSetting("colors").then(function(b){a.isLoading=!1;a.wocolors=b},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't get work order settings. Try refreshing your browser.")})})()}])})(angular,CricAdmin);(function(h,f){f.controller("base.AboutCtrl",["$scope","RequestContext",function(a,e){e.setWindowTitle("About")}])})(angular,CricBase);(function(h,f){f.controller("base.AppCtrl",["$scope","$route","$routeParams","$location","RequestContext","UserService",function(a,e,c,d,b,g){a.isLoading=!0;a.getInstanceTime=function(){return(new Date).toTimeString().match(/\d+:\d+:\d+/i)[0]};a.openModalWindow=function(b,d,c){a.$broadcast("showAlert",{type:b,title:c||("error"==b?"Opps...":"Hurray!"),message:d})};var l=b.getRenderContext();a.subview=l.getNextSection();a.$on("requestContextChanged",function(){l.isChangeRelevant()&&(a.subview=l.getNextSection())});
a.$on("$routeChangeSuccess",function(k){e.current.action&&(a.isLoading=!0,g.getUserProfile().then(function(d){a.isLoading=!1;b.setContext(e.current.action,c);a.$broadcast("requestContextChanged",b)},function(){a.isLoading=!1;d.path("/logoff")}))})}])})(angular,CricBase);(function(h,f){f.controller("base.LogoffCtrl",["$scope",function(a){}])})(angular,CricBase);(function(h,f){f.controller("base.NavCtrl",["$scope","_","$location","UserService",function(a,e,c,d){a.isActive=function(a){a=a.split(",");for(var d=c.path().split("/"),e=0;e<a.length;e++)if(-1<d.indexOf(a[e]))return"active";return""};(function(){d.getUserProfile().then(function(b){a.username=b.username},function(){c.path("/logoff")})})()}])})(angular,CricBase);(function(h,f){f.controller("base.UserProfileCtrl",["$scope","$q","_","Colors","RequestContext","UserService",function(a,e,c,d,b,g){a.isLoading=!0;a.colors=d;a.user={};a.confirmpassword="";a.onSaveClick=function(){g.setUserProfile(a.user).then(function(b){a.user=b;a.confirmpassword=a.user.password;a.openModalWindow("success","The user profile has been successfully saved.")},function(){a.openModalWindow("error","For some reason we couldn't save the user profile. Try refreshing your browser.")})};b.setWindowTitle("User Profile");
(function(){a.isLoading=!0;g.getUserProfile().then(function(b){a.isLoading=!1;a.user=b;a.confirmpassword=a.user.password},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't get a user profile. Try refreshing your browser.")})})()}])})(angular,CricBase);(function(h,f){f.controller("home.HomeCtrl",["$scope","RequestContext",function(a,e){var c=e.getRenderContext("home");a.subview=c.getNextSection();a.$on("requestContextChanged",function(){c.isChangeRelevant()&&(a.subview=c.getNextSection())})}])})(angular,Cric);(function(h,f){f.controller("home.ChartCtrl",["$scope","RequestContext",function(a,e){a.statistics={openwosbytrade:"Open WO's by Trade",emergencycallsbytrade:"Emergency calls by Trade",avghrsonclosedwos:"Avg. Hrs Charged on Closed WO's by Trade",toohottoocold:"Too Hot / Too \u0421old Calls",closedwosbytrade:"Closed WO's by Trade"};a.selectedStatistic="closedwosbytrade";e.setWindowTitle("Charts")}])})(angular,Cric);(function(h,f){f.controller("home.CityEngineCtrl",["$scope","$routeParams","RequestContext",function(a,e,c){c.setWindowTitle("Map - CityEngine");a.filename=e.fileUrl}])})(angular,Cric);(function(h,f){f.controller("home.DashboardCtrl",["$scope","RequestContext",function(a,e){a.$on("requestContextChanged",function(){c.isChangeRelevant()&&(a.subview=c.getNextSection())});var c=e.getRenderContext("home.dashboard");a.subview=c.getNextSection()}])})(angular,Cric);(function(h,f){f.controller("home.dashboard.GridCtrl",["$scope","RequestContext","UserService",function(a,e,c){a.isLoading=!0;a.widgets=[];a.$on("$destroy",function(){c.getUserProfile().then(function(d){d.widgets=a.widgets;return c.setUserProfile(d)},function(){a.openModalWindow("error","For some reason we couldn't get user profile. Try refreshing your browser.")})});e.setWindowTitle("Dashboard");(function(){a.isLoading=!0;c.getUserProfile().then(function(d){a.isLoading=!1;a.widgets=d.widgets},function(){a.isLoading=
!1;errorCallback("For some reason we couldn't load the dashboard configuration. Try refreshing your browser.")})})()}])})(angular,Cric);(function(h,f){f.controller("home.dashboard.ManagerCtrl",["$scope","$q","_","RequestContext","WorkOrderService","UserService",function(a,e,c,d,b,g){function l(){a.statuses=[];a.selectedStatuses=[];a.areas=[];a.selectedAreas=[];return e.all([b.getStatuses().then(function(b){a.statuses=b;c.findWithProperty(a.templates,"directive","cric-widget-work-order").options.statuses=c.keys(a.statuses)}),b.getAreas().then(function(b){a.areas=b;c.findWithProperty(a.templates,"directive","cric-widget-work-order").options.areas=
c.keys(a.areas)}),b.getTypes().then(function(b){a.types=b;c.findWithProperty(a.templates,"directive","cric-widget-work-order").options.types=c.keys(a.types)})])}a.isLoading=!0;a.widgets=[];a.statuses=[];a.selectedStatuses=[];a.areas=[];a.selectedAreas=[];a.types=[];a.selectedTypes=[];a.templates=[{title:"Work Orders",directive:"cric-widget-work-order",size_x:3,size_y:2,options:{startDate:Date.today().addDays(-1),endDate:Date.today(),statuses:[],types:[],areas:[]}},{title:"Map",directive:"cric-widget-map",
size_x:3,size_y:3},{title:"Calendar",directive:"cric-widget-calendar",size_x:3,size_y:2},{title:"Alerts",directive:"cric-widget-alerts",size_x:3,size_y:2},{title:"Emergency and Corrective Work",directive:"cric-widget-emergency",size_x:4,size_y:2},{title:"Weekly KPM",directive:"cric-widget-kpm",size_x:3,size_y:2},{title:"Chart",directive:"cric-widget-chart",size_x:3,size_y:3,options:{id:"openwosbytrade"}},{title:"Weather",directive:"cric-widget-weather",size_x:2,size_y:1,options:{locations:["2499253"],
woeid:!0,link:!1,unit:"f"}},{title:"Reports",directive:"cric-widget-reports",size_x:2,size_y:2}];a.statistics={openwosbytrade:"Open WO's by Trade",emergencycallsbytrade:"Emergency calls by Trade",avghrsonclosedwos:"Avg. Hrs Charged on Closed WO's by Trade",toohottoocold:"Too Hot / Too \u0421old Calls",closedwosbytrade:"Closed WO's by Trade"};a.onTemplateChange=function(b){a.widget=h.copy(b)};a.onAddWidgetClick=function(b){g.getUserProfile().then(function(a){a.widgets.push(c.extend(b,{id:a.widgets.length+
1}));return g.setUserProfile(a)},function(){a.openModalWindow("error","For some reason we couldn't get user profile. Try refreshing your browser.")}).then(function(d){a.widgets.push(h.copy(b));a.openModalWindow("success","The user profile has been successfully saved.")},function(){a.openModalWindow("error","For some reason we couldn't save user profile. Try refreshing your browser.")})};a.removeWidget=function(b){g.getUserProfile().then(function(a){a.widgets=c.without(a.widgets,c.findWithProperty(a.widgets,
"id",b.id));return g.setUserProfile(a)},function(){a.openModalWindow("error","For some reason we couldn't get user profile. Try refreshing your browser.")}).then(function(d){a.widgets=c.without(a.widgets,c.findWithProperty(a.widgets,"id",b.id));a.openModalWindow("success","The user profile has been successfully saved.")},function(){a.openModalWindow("error","For some reason we couldn't save user profile. Try refreshing your browser.")})};d.setWindowTitle("Dashboard - Management");(function(){a.isLoading=
!0;l().then(function(a){return g.getUserProfile()},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't load dictionaries. Try refreshing your browser.")}).then(function(b){a.widgets=b.widgets;a.template=a.templates[0];a.widget=h.copy(a.template);a.isLoading=!1},function(){a.isLoading=!1;errorCallback("For some reason we couldn't load the user profile. Try refreshing your browser.")})})()}])})(angular,Cric);(function(h,f){f.controller("home.designreview.DesignReviewCtrl",["$scope","$routeParams","RequestContext",function(a,e,c){a.fileUrl=e.fileUrl;var d=c.getRenderContext("home.designreview");a.subview=d.getNextSection();a.$on("requestContextChanged",function(){d.isChangeRelevant()&&(a.subview=d.getNextSection())})}])})(angular,Cric);(function(h,f){f.controller("home.designreview.WorkOrderCtrl",["$scope","$rootScope","$routeParams","$q","_","RequestContext","UserService","WorkOrderService",function(a,e,c,d,b,g,l,k){function f(){a.types=[];a.systems=[];a.priorities=[];a.buildings=[];a.statuses=[];a.trades=[];a.selectedTypes=[];a.selectedSystems=[];a.selectedPriorities=[];a.selectedBuildings=[];a.selectedStatuses=[];a.selectedTrades=[];return d.all([k.getTypes().then(function(d){a.types=d;a.selectedTypes=b.keys(a.types)}),k.getSystems().then(function(d){a.systems=
d;a.selectedSystems=b.keys(a.systems)}),k.getPriorities().then(function(d){a.priorities=d;a.selectedPriorities=b.keys(a.priorities)}),k.getBuildings().then(function(d){a.buildings=d;a.selectedBuildings=b.keys(a.buildings)}),k.getStatuses().then(function(d){a.statuses=d;a.selectedStatuses=b.keys(a.statuses)}),k.getTrades().then(function(d){a.trades=d;a.selectedTrades=b.keys(a.trades)}),l.getUserProfile().then(function(b){a.colors=b.colors})])}function h(){a.isLoading=!0;a.isDataAvailable=!1;a.pageIndex=
1;a.orders=null;a.selectedOrder=null;a.table.isSelectAll=!1;k.getWorkOrders([{name:"bim",values:[c.fileUrl.substr(c.fileUrl.lastIndexOf("/")+1)]},{name:"System",values:a.selectedSystems},{name:"Building",values:a.selectedBuildings},{name:"Priority",values:a.selectedPriorities},{name:"Type",values:a.selectedTypes},{name:"Status",values:a.selectedStatuses},{name:"assetnum",values:""==a.table.assetnum?[]:a.table.assetnum.split(",")},{name:"WONUM",values:""==a.table.wonum?[]:a.table.wonum.split(",")},
{isdate:!0,name:"StartDate",values:[a.dateRange.start.toString("MMddyyyy"),a.dateRange.end.toString("MMddyyyy")]}],{sortby:a.table.sortby,sortdesc:a.table.sortdesc}).then(function(d){for(var c=a,e=a.table.size,g=[],k=[],v=0;v<d.length;v++){var x=b.extend(d[v],{_number:v+1,_selected:!1});k.length>=e&&(g.push(k),k=[]);k.push(x)}k.length<=e&&g.push(k);c.orders=g;a.selectedOrder=a.orders[0][0];a.isDataAvailable=0<d.length;a.isLoading=!1},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't get work orders information. Try refreshing your browser.")})}
a.isLoading=!0;a.isDataAvailable=!1;a.pageIndex=1;a.orders=null;a.selectedOrder=null;a.types=[];a.systems=[];a.priorities=[];a.buildings=[];a.statuses=[];a.trades=[];a.colors={};a.selectedTypes=[];a.selectedSystems=[];a.selectedPriorities=[];a.selectedBuildings=[];a.selectedStatuses=[];a.selectedTrades=[];a.dateRange={start:Date.today().addYears(-1),end:Date.today()};a.table={sizes:[5,10,15],size:5,isSelectAll:!1,selectedCount:0,hasSelected:!1,sortby:"assetnum",sortdesc:!1,assetnum:"",wonum:""};a.$watch("startDate",
function(){console.log(a.startDate)});a.onPageSizeChanged=function(){h()};a.onSlide=function(b){a.pageIndex="prev"==b?1==a.pageIndex?a.orders.length:a.pageIndex-1:a.pageIndex==a.orders.length?1:a.pageIndex+1};a.onSelectWorkOrder=function(b){a.selectedOrder=b};a.onCheckAll=function(){a.table.selectedCount=0;b.forEach(a.orders,function(d){b.forEach(d,function(b){b._selected=a.table.isSelectAll;b._selected&&a.table.selectedCount++})});a.table.hasSelected=0<a.table.selectedCount};a.onCheck=function(b){a.table.isSelectAll=
!1;b._selected?a.table.selectedCount++:a.table.selectedCount--;a.table.hasSelected=0<a.table.selectedCount};a.onSearchClick=function(){h()};a.onResetClick=function(){a.table.assetnum="";a.table.wonum="";f()};a.onReassignClick=function(){alert("Order #"+a.selectedOrder.WONUM+" has been successfully re-assgned.")};a.sortBy=function(b){a.table.sortby==b?a.table.sortdesc=!a.table.sortdesc:(a.table.sortby=b,a.table.sortdesc=!1);h()};a.isSortBy=function(b){return b==a.table.sortby?a.table.sortdesc?"sorting_desc":
"sorting_asc":"sorting"};a.onIsolateSelected=function(){var d=[];b.forEach(a.orders,function(a){d=d.concat(b.filterWithProperty(a,"_selected",!0))});e.$broadcast("designreview:isolateSelected",d)};a.onExportSelected=function(){alert("TBD")};a.formatDate=function(a){return(a=Date.parse(a))?a.toString("MM/dd/yyyy"):"n//a"};a.$on("$destroy",function(){});e.$on("designreview:objectproperties",function(b,d){a.$apply(function(){a.table.assetnum=$.trim(d);h()})});g.setWindowTitle("Map - DesingReview");(function(){a.isLoading=
!0;a.isDataAvailable=!1;f().then(function(a){h()},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't load dictionaries. Try refreshing your browser.")})})()}])})(angular,Cric);(function(h,f){f.controller("home.LogoffCtrl",["$scope",function(a){}])})(angular,Cric);(function(h,f){f.controller("home.map.InfoCtrl",["$scope","$rootScope","$http","$q","$location","_","RequestContext","MapService",function(a,e,c,d,b,g,l,k){function f(b){b&&("point"==b.feature.geometry.type?b.feature.setSymbol(a.markerSymbol):b.feature.setSymbol(a.fillSymbol),k.getMap().graphics.add(b.feature))}function h(a){for(var b=[],d=[],c=0;c<a.length;c++)4<=d.length&&(b.push(d),d=[]),d.push({name:a[c],url:m(a[c])});0<d.length&&4>=d.length&&b.push(d);return b}function m(a){var b=a.split(".").pop().toLowerCase();
return"dwf"==b?"#!/home/map/designreview?fileUrl="+encodeURI(a):"3ws"==b?"Netscape"==window.navigator.appName?"#!/home/map/cityengine?fileUrl="+encodeURI(a):"javascript:void window.open('cityengine/viewer.html?3dWebScene=../webscenes/"+encodeURI(a)+"');":"javascript:alert('Unsupported file type.')"}function n(a,b){for(var d=[],c=0;c<a.visibleLayers.length;c++){var e=g.findWithProperty(a.layerInfos,"id",a.visibleLayers[c]),k=b<=e.minScale&&b>=e.maxScale||0==e.minScale&&0==e.maxScale;null==e.subLayerIds&&
k&&d.push(a.visibleLayers[c])}return d}function q(b,c){var e=k.getMap(),q=e.getScale(),l=new esri.tasks.IdentifyParameters;l.tolerance=5;l.returnGeometry=!0;l.layerIds=n(e.getLayer(c.id),q);l.layerOption=esri.tasks.IdentifyParameters.LAYER_OPTION_VISIBLE;l.width=e.width;l.height=e.height;l.geometry=b;l.mapExtent=e.extent;var t=d.defer();(new esri.tasks.IdentifyTask(c.url)).execute(l,function(b){a.$apply(function(){g.forEach(b,function(a){g.extend(a,{mapid:c.id});a.layerName=c.title+" / "+a.layerName;
var b=g.findWithProperty(c.layerInfos,"id",a.layerId);b&&g.extend(a,{resource:b.resource,keyname:b.keyname})});t.resolve(b)})});return t.promise}function u(a){var b=d.defer();a.resource?c.get(resource).then(function(d){g.extend(a.feature.attributes,g.findWithProperty(d.data,a.keyname,a.feature.attributes[a.keyname]));b.resolve(a)},function(){b.reject()}):b.resolve(a);return b.promise}function t(){a.fillSymbol=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,
new dojo.Color([255,0,0]),2),new dojo.Color([255,255,0,0.25]));a.markerSymbol=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,10,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color([255,0,0]),1),new dojo.Color([255,0,0,1]));a.point&&(a.isLoading=!0,k.waitForLayers(a).then(function(a){return k.getConfig()},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't get information. Try refreshing your browser.")}).then(function(b){a.config=
b;b=a.point;for(var c=[],e=0;e<a.config.layers.length;e++)c.push(q(b,a.config.layers[e]));return d.all(c)},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't get map config. Try refreshing your browser.")}).then(function(a){for(var b=[],c=0;c<a.length;c++)for(var e=a[c],k=0;k<e.length;k++)b.push(u(e[k]));return d.all(b)},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't get information. Try refreshing your browser.")}).then(function(b){for(var d=
a,c=[],e=0;e<b.length;e++){var q=b[e],l=g.findWithProperty(a.config.layers,"id",q.mapid);g.extend(q.feature,{type:"info",pages:[]});var t=Object.keys(q.feature.attributes);t.sort();for(var n={},f=0;f<t.length;f++){var h=t[f],m;m=h;var u=g.findWithProperty(l.layerInfos,"id",q.layerId);m=u?g.contains(u.fields,m):!0;m&&(n[h]=q.feature.attributes[h],10==Object.keys(n).length&&(q.feature.pages.push(n),n={}))}0<Object.keys(n).length&&10>Object.keys(n).length&&q.feature.pages.push(n);c.push(q)}d.idResults=
c;for(d=b=0;d<a.idResults.length;d++)if(a.idResults[d].layerId==a.actionContext.layerid){b=d;break}a.idResult=a.idResults[b];if(a.idResult)return k.getFeatureAttachments(a.idResult)},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't get features information. Try refreshing your browser.")}).then(function(b){b&&(a.attachments={pages:h(b)});a.isLoading=!1;a.idResult&&(a.isDataAvailable=!0,f(a.idResult))},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't get files information. Try refreshing your browser.")}))}
a.isLoading=!1;a.isDataAvailable=!1;a.idResults=[];a.idResult=null;a.point=null;a.attachments=[];a.onChangeFeature=function(b){k.clearGraphics(["info"]);a.isLoading=!0;k.getFeatureAttachments(b).then(function(d){a.isLoading=!1;d&&(a.attachments={pages:h(d)});f(b)},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't get model's information. Try refreshing your browser.")})};a.onLocate=function(a){var b=esri.graphicsExtent([a.feature]);b||(a=a.feature.geometry,b=new esri.geometry.Extent(a.x-
1,a.y-1,a.x+1,a.y+1,a.spatialReference));b&&k.getMap().setExtent(b.expand(1.12))};a.onClear=function(){k.clearGraphics(["info"]);a.isDataAvailable=!1;a.idResults=[];a.idResult=null;a.point=null;a.attachments=[]};a.onClickAttachment=function(a){var d=a.name.split(".").pop().toLowerCase();"dwf"==d?b.path("/home/map/designreview?fileUrl="+encodeURI(a.name)):"3ws"==d?confirm("To view CityEngine Web Scene you will be redirected to another page.")&&window.open("cityengine/viewer.html?3dWebScene=../../webscenes/"+
encodeURI(a.name)):alert("Unsupported file type.");return!1};a.$on("$destroy",function(){a.isDataAvailable?l.setActionContext("home.map.info",{point:a.point.toJson(),layerid:a.idResult.layerId}):l.setActionContext("home.map.info",null);a.mapOnClickHandler();k.clearGraphics(["info"])});a.mapOnClickHandler=e.$on("mapOnClick",function(b,d){a.$apply(function(){a.onClear();a.point=d.mapPoint;t()})});a.actionContext=l.getActionContext("home.map.info");k.getOnClickEvent()?(a.point=k.getOnClickEvent().mapPoint,
k.setOnClickEvent(null)):a.actionContext.point&&(a.point=new esri.geometry.Point(a.actionContext.point));l.setWindowTitle("Map - Information");t()}])})(angular,Cric);(function(h,f){f.controller("home.MapCtrl",["$scope","$rootScope","$location","_","RequestContext","MapService",function(a,e,c,d,b,g){function l(){var a=[],b=g.getMap().getLayersVisibleAtScale(g.getMap().getScale());d.forEach(b,function(b){b instanceof esri.layers.ArcGISDynamicMapServiceLayer&&a.push({id:b.id,layers:b.visibleLayers})});return a}function k(){var a=[];d.forEach(g.getMap().graphics.graphics,function(b){b.type&&a.push(d.extend(b.toJson(),{type:b.type}))});return a}function f(a){if(a){var b=
g.getMap().getLayersVisibleAtScale(g.getMap().getScale());d.forEach(b,function(b){var c=d.findWithProperty(a,"id",b.id);c&&b.setVisibleLayers(c.layers)})}}function h(a){a&&d.forEach(a,function(a){g.getMap().graphics.add(d.extend(new esri.Graphic(a),{type:a.type}))})}a.isLoading=!0;a.$on("onLayersAddResult",function(){f(a.actionContext.visibleLayers);h(a.actionContext.graphics)});a.$on("onClick",function(b,d){g.isOnClick()&&(a.$apply(function(){g.setOnClickEvent(d);c.path("/home/map/info")}),e.$broadcast("mapOnClick",
d))});a.$on("requestContextChanged",function(){m.isChangeRelevant()&&(a.subview=m.getNextSection())});a.$on("$destroy",function(){b.setActionContext("home.map",{extent:g.getMap().extent.toJson(),scale:g.getMap().getScale(),visibleLayers:l(),graphics:k()})});var m=b.getRenderContext("home.map");a.actionContext=b.getActionContext("home.map");a.subview=m.getNextSection();b.setWindowTitle("Map");(function(){a.isLoading=!0;g.getConfig().then(function(b){a.basemap=new esri.layers.ArcGISTiledMapServiceLayer(b.basemap);
for(var c=[],e=0;e<b.layers.length;e++){var k=b.layers[e];c.push(new esri.layers.ArcGISDynamicMapServiceLayer(k.url,{id:k.id,opacity:k.opacity}))}a.layers=c;a.options=d.merge(b.options,{extent:new esri.geometry.Extent(a.actionContext.extent||b.initialExtent),scale:a.actionContext.scale});a.isLoading=!1},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't load the map configuration. Try refreshing your browser.")})})()}])})(angular,Cric);(function(h,f){f.controller("home.map.TocCtrl",["$scope","$timeout","RequestContext","MapService",function(a,e,c,d){function b(b){e(function(){for(var c=agsjs.dijit.TOC,e=d.getMap(),f=d.getMap(),h=[],m=0;m<b.layers.length;m++)h.push({layer:f.getLayer(b.layers[m].id),title:b.layers[m].title});(new c({map:e,layerInfos:h},a.tocid)).startup()},0)}a.isLoading=!0;c.setWindowTitle("Map - Layers");(function(){a.isLoading=!0;d.waitForLayers(a).then(function(a){return d.getConfig()},function(){a.isLoading=
!1;a.openModalWindow("error","For some reason we couldn't get map layers. Try refreshing your browser.")}).then(function(d){b(d);a.isLoading=!1},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't load layers information. Try refreshing your browser.")})})()}])})(angular,Cric);(function(h,f){f.controller("home.map.ToolsCtrl",["$scope","$location","_","RequestContext",function(a,e,c,d){a.isLoading=!1;a.tools=[{id:"bookmarks",name:"Bookmarks",route:"/home/map/tools/bookmarks"},{id:"query",name:"Query",route:"/home/map/tools/query"}];a.$on("requestContextChanged",function(){b.isChangeRelevant()&&(a.subview=b.getNextSection(),a.tool=c.findWithProperty(a.tools,"id",a.subview))});a.onToolSelected=function(a){e.path(a.route)};a.$on("$destroy",function(){d.setActionContext("home.map.tools",
{tool:a.tool})});var b=d.getRenderContext("home.map.tools");a.actionContext=d.getActionContext("home.map.tools");a.subview=a.actionContext.tool?a.actionContext.tool.id:b.getNextSection();a.tool=c.findWithProperty(a.tools,"id",a.subview)}])})(angular,Cric);(function(h,f){f.controller("home.map.tools.BookmarksCtrl",["$scope","_","RequestContext","MapService","UserService",function(a,e,c,d,b){function g(b){a.bookmarks=b.bookmarks.concat(a.bookmarks)}a.isLoading=!0;a.bookmark={name:""};a.setExtent=function(a){d.getMap().setExtent(new esri.geometry.Extent(a.extent))};a.deleteBookmark=function(c){a.isLoading=!0;b.getUserProfile().then(function(a){a.bookmarks=e.without(a.bookmarks,e.findWithProperty(a.bookmarks,"id",c.id));return b.setUserProfile(a)},function(){a.isLoading=
!1;a.openModalWindow("error","For some reason we couldn't get user profile. Try refreshing your browser.")}).then(function(b){a.bookmark.name="";a.bookmarks=b.bookmarks;return d.getConfig()},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't save user profile. Try refreshing your browser.")}).then(function(b){a.isLoading=!1;g(b)},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't load the map configuration. Try refreshing your browser.")})};
a.addBookmark=function(c){a.isLoading=!0;b.getUserProfile().then(function(a){a.bookmarks.push({id:a.bookmarks.length+1,name:c,extent:d.getMap().extent.toJson()});return b.setUserProfile(a)},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't get user profile. Try refreshing your browser.")}).then(function(b){a.bookmark.name="";a.bookmarks=b.bookmarks;return d.getConfig()},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't save user profile. Try refreshing your browser.")}).then(function(b){a.isLoading=
!1;g(b)},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't load the map configuration. Try refreshing your browser.")})};c.setWindowTitle("Map - Bookmarks");(function(){a.isLoading=!0;b.getUserProfile().then(function(b){a.bookmarks=b.bookmarks;return d.getConfig()},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't load the bookmarks configuration. Try refreshing your browser.")}).then(function(b){a.isLoading=!1;g(b)},function(){a.isLoading=
!1;a.openModalWindow("error","For some reason we couldn't load the map configuration. Try refreshing your browser.")})})()}])})(angular,Cric);(function(h,f){f.controller("home.map.tools.QueryCtrl",["$scope","$location","_","RequestContext","MapService",function(a,e,c,d,b){a.isLoading=!1;a.types=[{id:"attributes",name:"By attributes",route:"/home/map/tools/query/attributes"},{id:"location",name:"By location",route:"/home/map/tools/query/location"}];a.$on("requestContextChanged",function(){g.isChangeRelevant()&&(a.subview=g.getNextSection(),a.type=c.findWithProperty(a.types,"id",a.subview))});a.onQueryTypeChanged=function(a){e.path(a.route)};
a.$on("$destroy",function(){d.setActionContext("home.map.tools.query",{type:a.type})});var g=d.getRenderContext("home.map.tools.query");a.actionContext=d.getActionContext("home.map.tools.query");a.subview=a.actionContext.type?a.actionContext.type.id:g.getNextSection();a.type=c.findWithProperty(a.types,"id",a.subview)}])})(angular,Cric);(function(h,f){f.controller("home.map.tools.query.AttributesCtrl",["$scope","$rootScope","$q","$http","_","RequestContext","MapService",function(a,e,c,d,b,g,l){function k(d){a.layers=[];for(var c=a.config,e=l.getMap().getScale(),k=0;k<c.layers.length;k++){var g=c.layers[k],f=l.getMap().getLayer(g.id);b.forEach(f.layerInfos,function(c){var k=null==c.subLayerIds,q=e<=c.minScale&&e>=c.maxScale||0==c.minScale&&0==c.maxScale,l=b.findWithProperty(g.layerInfos,"id",c.id);k&&(q&&l)&&a.layers.push({mapid:g.id,
layerid:c.id,resource:l.resource,keyname:l.keyname,name:g.title+" / "+c.name,url:g.url+"/"+c.id,fields:b.sortBy(b.filter(b.findWithProperty(b.findWithProperty(d,"mapid",g.id).data.layers,"id",c.id).fields,function(a){return b.contains(l.fields,a.name)}),function(a){return a.name})})})}if(a.layers){a.layers=b.sortBy(a.layers,function(a){return a.name});for(k=c=0;k<a.layers.length;k++)if(a.layers[k].layerid==a.actionContext.layerid){c=k;break}a.layer=a.layers[c];k=l.getQueryContext();k.layer&&k.layer.url!=
a.layer.url&&l.clearQueryContext();for(k=c=0;k<a.layer.fields.length;k++)if(a.layer.fields[k].name==a.actionContext.field){c=k;break}a.field=a.layer.fields[c];a.searchText=a.actionContext.searchText||a.searchText;a.filterByExtent=a.actionContext.filterByExtent||!1}}function f(a){var d=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,30,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color([255,0,0]),1),new dojo.Color([0,255,0,0.25])),
c=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASH,new dojo.Color([255,0,0]),1),e=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_NONE,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,new dojo.Color([255,0,0]),2),new dojo.Color([255,255,0,0.25])),k=l.getMap();b.forEach(a.features,function(a){b.extend(a,{type:"query"});switch(a.geometry.type){case "point":a.setSymbol(d);break;case "polyline":a.setSymbol(c);break;case "polygon":a.setSymbol(e)}k.graphics.add(a)});
var g;0<a.features.length&&(g=esri.graphicsExtent(a.features),!g&&1==a.features.length&&(a=a.features[0],g=new esri.geometry.Extent(a.x-1,a.y-1,a.x+1,a.y+1,a.spatialReference)),g&&(g=g.expand(1.12),k.setExtent(g)));return g}function s(b,d,c,e){var k=new esri.tasks.QueryTask(d.url),g=new esri.tasks.Query;g.returnGeometry=!0;g.outFields=["*"];g.outSpatialReference=l.getMap().spatialReference;g.where=c.name+" LIKE '%"+b+"%'";e&&(g.geometry=l.getMap().extent);a.isLoading=!0;k.execute(g,function(b){l.getFeaturesData(b,
h.copy(d)).then(function(b){var d=b.results;l.setQueryContext(d,b.layer,f(d));a.isLoading=!1},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't load features data configuration. Try refreshing your browser.")})},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't execute the query. Try refreshing your browser.")})}function m(){var a=l.getQueryContext();return a.results&&0<a.results.features.length}a.isLoading=!1;a.searchText="0038001";a.onLayerChange=
function(b){a.searchText="";a.field=b.fields[0];var d=l.getQueryContext();d.layer&&d.layer.url!=b.url&&l.clearQueryContext()};a.execute=function(a,b,d,c){s(a,b,d,c)};a.hasQueryGraphics=function(){return m()||l.hasGraphics(["query","highlight"])};a.hasQueryResults=function(){return m()?"":"disabled"};a.onClearResults=function(){l.clearQueryContext()};a.$on("$destroy",function(){g.setActionContext("home.map.tools.query.attributes",{searchText:a.searchText,layerid:a.layer.layerid,field:a.field.name,
filterByExtent:a.filterByExtent})});a.actionContext=g.getActionContext("home.map.tools.query.attributes");g.setWindowTitle("Map - Query by Attributes");(function(){a.isLoading=!0;l.waitForLayers(a).then(function(a){return l.getConfig()},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't get map layers. Try refreshing your browser.")}).then(function(b){a.config=b;for(var d=[],e=0;e<b.layers.length;e++){var k=b.layers[e];d.push(l.getLayers(k.url,k.id))}return c.all(d)},
function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't load the map configuration. Try refreshing your browser.")}).then(function(b){k(b);a.isLoading=!1},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't load layers information. Try refreshing your browser.")})})()}])})(angular,Cric);(function(h,f){f.controller("home.map.tools.query.LocationCtrl",["$scope","$rootScope","$q","_","RequestContext","MapService",function(a,e,c,d,b,g){function l(b){a.layers=[];for(var c=a.config,e=g.getMap().getScale(),k=0;k<c.layers.length;k++){var l=c.layers[k],f=g.getMap().getLayer(l.id);d.forEach(f.layerInfos,function(c){var k=null==c.subLayerIds,g=e<=c.minScale&&e>=c.maxScale||0==c.minScale&&0==c.maxScale,f=d.findWithProperty(l.layerInfos,"id",c.id);k&&(g&&f)&&a.layers.push({mapid:l.id,layerid:c.id,
resource:f.resource,keyname:f.keyname,name:l.title+" / "+c.name,url:l.url+"/"+c.id,fields:d.sortBy(d.filter(d.findWithProperty(d.findWithProperty(b,"mapid",l.id).data.layers,"id",c.id).fields,function(a){return d.contains(f.fields,a.name)}),function(a){return a.name})})})}if(a.layers){a.layers=d.sortBy(a.layers,function(a){return a.name});for(k=c=0;k<a.layers.length;k++)if(a.layers[k].layerid==a.actionContext.layerid){c=k;break}a.layer=a.layers[c];k=g.getQueryContext();k.layer&&k.layer.url!=a.layer.url&&
g.clearQueryContext()}}function k(b,d){g.getFeaturesData(b,d).then(function(b){var d=b.results;b=b.layer;var c=m(d);g.setQueryContext(d,b,c);a.isLoading=!1},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't load features data configuration. Try refreshing your browser.")})}function f(b){var d=new esri.tasks.QueryTask(a.layer.url),c=new esri.tasks.Query;c.returnGeometry=!0;c.geometry=b;c.outFields=["*"];a.isLoading=!0;d.execute(c,function(b){k(b,h.copy(a.layer))},function(){a.isLoading=
!1;a.openModalWindow("error","For some reason we couldn't execute the query. Try refreshing your browser.")})}function s(b){a.$apply(function(){a.toolbar.deactivate();a.drawEnd=!0;g.enableOnClick();var c=g.getMap();c.showZoomSlider();switch(b.type){case "point":var e=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_SQUARE,10,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color([255,0,0]),1),new dojo.Color([0,255,0,0.25]));break;case "polyline":e=
new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASH,new dojo.Color([255,0,0]),1);break;case "polygon":e=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,new dojo.Color([255,0,0]),2),new dojo.Color([255,255,0,0.25]));break;case "extent":e=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,
new dojo.Color([255,0,0]),2),new dojo.Color([255,255,0,0.25]));break;case "multipoint":e=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_DIAMOND,20,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,new dojo.Color([0,0,0]),1),new dojo.Color([255,255,0,0.5]))}e=new esri.Graphic(b,e,{type:"query"});c.graphics.add(d.extend(e,{type:"query"}));f(b)})}function m(a){var b=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,30,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
new dojo.Color([255,0,0]),1),new dojo.Color([0,255,0,0.25])),c=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASH,new dojo.Color([255,0,0]),1),e=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_NONE,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,new dojo.Color([255,0,0]),2),new dojo.Color([255,255,0,0.25])),k=g.getMap();d.forEach(a.features,function(a){d.extend(a,{type:"query"});switch(a.geometry.type){case "point":a.setSymbol(b);
break;case "polyline":a.setSymbol(c);break;case "polygon":a.setSymbol(e)}k.graphics.add(a)});var l;0<a.features.length&&(l=esri.graphicsExtent(a.features),!l&&1==a.features.length&&(a=a.features[0],l=new esri.geometry.Extent(a.x-1,a.y-1,a.x+1,a.y+1,a.spatialReference)),l&&(l=l.expand(1.12),k.setExtent(l)));return l}function n(){var a=g.getQueryContext();return"undefined"!=typeof a.results&&0<a.results.features.length}a.isLoading=!1;a.drawEnd=!1;a.hasQueryGraphics=function(){return n()||g.hasGraphics(["query",
"highlight"])};a.hasQueryResults=function(){return n()?"":"disabled"};a.onLayerChange=function(a){var b=g.getQueryContext();b.layer&&b.layer.url!=a.url&&g.clearQueryContext()};a.onDrawToolSelected=function(b){g.disableOnClick();g.getMap().hideZoomSlider();a.drawEnd=!1;a.toolbar.activate(b)};a.onClearResults=function(){g.clearQueryContext()};a.$on("$destroy",function(){b.setActionContext("home.map.tools.query.location",{layerid:a.layer.layerid})});a.actionContext=b.getActionContext("home.map.tools.query.location");
b.setWindowTitle("Map - Query by Location");(function(){a.isLoading=!0;g.waitForLayers(a).then(function(a){return g.getConfig()},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't get map layers. Try refreshing your browser.")}).then(function(b){a.config=b;for(var d=[],e=0;e<b.layers.length;e++){var k=b.layers[e];d.push(g.getLayers(k.url,k.id))}return c.all(d)},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't load the map configuration. Try refreshing your browser.")}).then(function(b){l(b);
a.toolbar=new esri.toolbars.Draw(g.getMap(),{showTooltips:!0});dojo.connect(a.toolbar,"onDrawEnd",s);a.isLoading=!1},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't load layers information. Try refreshing your browser.")})})()}])})(angular,Cric);(function(h,f){f.controller("home.map.tools.query.ResultsCtrl",["$scope","$rootScope","$location","_","MapService",function(a,e,c,d,b){function g(){a.pageIndex=1;var c=b.getQueryContext();if(c.results){for(var d=a.results,e=[{name:"#",alias:"#"}],g=0;g<c.layer.fields.length;g++){var l=c.layer.fields[g];e.push({name:l.name,alias:l.alias})}d.columns=e;for(var d=a.results,e=a.page.size.rows,g=[],l=[],f=0;f<c.results.features.length;f++){var h=c.results.features[f];l.length>=e&&(g.push(l),l=[]);var t=
[];t.push(f+1);for(var v=0;v<c.layer.fields.length;v++)t.push(h.attributes[c.layer.fields[v].name]);l.push(t)}l.length<=e&&g.push(l);d.pages=g;d=a.results;e="#,";for(g=0;g<c.layer.fields.length;g++)l=c.layer.fields[g],e+=l.alias,g<c.layer.fields.length-1&&(e+=",");e+="\n";for(g=0;g<c.results.features.length;g++){f=c.results.features[g];e=e+(g+1)+",";for(h=0;h<c.layer.fields.length;h++)l=c.layer.fields[h],e+=f.attributes[l.name],h<c.layer.fields.length-1&&(e+=",");e+="\n"}d.csv=e}}function l(){var a=
b.getQueryContext();return"undefined"!=typeof a.results&&0<a.results.features.length}a.isLoading=!1;a.pageIndex=1;a.selectedFeature=null;a.results={csv:"",columns:[],pages:[]};a.page={sizes:[{height:"225px",rows:5},{height:"370px",rows:10},{height:"515px",rows:15}],size:null};a.hasQueryResults=function(){return l()};a.hasQueryGraphics=function(){return l()||b.hasGraphics(["query","highlight"])};a.onClearResults=function(){b.clearQueryContext();a.results={csv:"",columns:[],pages:[]}};a.onExportResults=
function(){$("#export-results-form").submit()};a.onSlide=function(b){a.pageIndex="prev"==b?1==a.pageIndex?a.results.pages.length:a.pageIndex-1:a.pageIndex==a.results.pages.length?1:a.pageIndex+1};a.highlightFeature=function(c){a.selectedFeature=c;b.clearGraphics(["highlight"]);var e=b.getQueryContext().results.features[a.selectedFeature[0]-1],g=new esri.symbol.SimpleMarkerSymbol(esri.symbol.SimpleMarkerSymbol.STYLE_CIRCLE,30,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_SOLID,
new dojo.Color([0,0,0]),1),new dojo.Color([255,0,0,0.8])),l=new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASH,new dojo.Color([255,0,0]),1),f=new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,new dojo.Color([255,0,0]),2),new dojo.Color([58,135,173,0.25]));c=b.getMap();switch(e.geometry.type){case "point":e.setSymbol(g);break;case "polyline":e.setSymbol(l);break;case "polygon":e.setSymbol(f)}d.extend(e,
{type:"highlight"});c.graphics.add(e);g=esri.graphicsExtent([e]);g||(e=e.geometry,g=new esri.geometry.Extent(e.x-1,e.y-1,e.x+1,e.y+1,e.spatialReference));g&&c.setExtent(g.expand(1.12))};a.onShowAll=function(){var a=b.getQueryContext();b.getMap().setExtent(a.results.extent)};a.$on("$destroy",function(){a.queryContextChangedHandler()});a.onPageSizeChanged=function(){g()};a.queryContextChangedHandler=e.$on("queryContextChanged",function(){g()});(function(){a.isLoading=!0;b.waitForLayers(a).then(function(a){return b.getConfig()},
function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't get map layers. Try refreshing your browser.")}).then(function(b){a.config=b;g();a.isLoading=!1},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't load layers information. Try refreshing your browser.")})})()}])})(angular,Cric);(function(h,f){f.controller("home.ReportCtrl",["$scope","RequestContext",function(a,e){e.setWindowTitle("Reports")}])})(angular,Cric);(function(h,f){f.controller("home.WorkOrderCtrl",["$scope","$rootScope","$routeParams","$q","_","RequestContext","UserService","WorkOrderService",function(a,e,c,d,b,g,l,k){function f(){a.types=[];a.systems=[];a.priorities=[];a.buildings=[];a.statuses=[];a.trades=[];a.selectedTypes=[];a.selectedSystems=[];a.selectedPriorities=[];a.selectedBuildings=[];a.selectedStatuses=[];a.selectedTrades=[];return d.all([k.getTypes().then(function(c){a.types=c;a.selectedTypes=b.keys(a.types)}),k.getSystems().then(function(c){a.systems=
c;a.selectedSystems=b.keys(a.systems)}),k.getPriorities().then(function(c){a.priorities=c;a.selectedPriorities=b.keys(a.priorities)}),k.getBuildings().then(function(c){a.buildings=c;a.selectedBuildings=b.keys(a.buildings)}),k.getStatuses().then(function(c){a.statuses=c;a.selectedStatuses=b.keys(a.statuses)}),k.getTrades().then(function(c){a.trades=c;a.selectedTrades=b.keys(a.trades)}),l.getUserProfile().then(function(b){a.colors=b.colors})])}function h(){a.isLoading=!0;a.isDataAvailable=!1;a.pageIndex=
1;a.orders=null;a.selectedOrder=null;a.table.isSelectAll=!1;k.getWorkOrders([{name:"System",values:a.selectedSystems},{name:"Building",values:a.selectedBuildings},{name:"Priority",values:a.selectedPriorities},{name:"Type",values:a.selectedTypes},{name:"Status",values:a.selectedStatuses},{name:"assetnum",values:""==a.table.assetnum?[]:a.table.assetnum.split(",")},{name:"WONUM",values:""==a.table.wonum?[]:a.table.wonum.split(",")},{isdate:!0,name:"StartDate",values:[a.dateRange.start.toString("MMddyyyy"),
a.dateRange.end.toString("MMddyyyy")]}],{sortby:a.table.sortby,sortdesc:a.table.sortdesc}).then(function(c){for(var d=a,e=a.table.size,g=[],k=[],l=0;l<c.length;l++){var f=b.extend(c[l],{_number:l+1,_selected:!1});k.length>=e&&(g.push(k),k=[]);k.push(f)}k.length<=e&&g.push(k);d.orders=g;a.selectedOrder=a.orders[0][0];a.isDataAvailable=0<c.length;a.isLoading=!1},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't get work orders information. Try refreshing your browser.")})}
a.isLoading=!0;a.isDataAvailable=!1;a.pageIndex=1;a.orders=null;a.selectedOrder=null;a.types=[];a.systems=[];a.priorities=[];a.buildings=[];a.statuses=[];a.trades=[];a.colors={};a.selectedTypes=[];a.selectedSystems=[];a.selectedPriorities=[];a.selectedBuildings=[];a.selectedStatuses=[];a.selectedTrades=[];a.dateRange={start:Date.today().addYears(-1),end:Date.today()};a.table={sizes:[5,10,15],size:5,isSelectAll:!1,selectedCount:0,hasSelected:!1,sortby:"assetnum",sortdesc:!1,assetnum:"",wonum:""};a.$watch("startDate",
function(){console.log(a.startDate)});a.onPageSizeChanged=function(){h()};a.onSlide=function(b){a.pageIndex="prev"==b?1==a.pageIndex?a.orders.length:a.pageIndex-1:a.pageIndex==a.orders.length?1:a.pageIndex+1};a.onSelectWorkOrder=function(b){a.selectedOrder=b};a.onCheckAll=function(){a.table.selectedCount=0;b.forEach(a.orders,function(c){b.forEach(c,function(b){b._selected=a.table.isSelectAll;b._selected&&a.table.selectedCount++})});a.table.hasSelected=0<a.table.selectedCount};a.onCheck=function(b){a.table.isSelectAll=
!1;b._selected?a.table.selectedCount++:a.table.selectedCount--;a.table.hasSelected=0<a.table.selectedCount};a.onSearchClick=function(){h()};a.onResetClick=function(){a.table.assetnum="";a.table.wonum="";f()};a.onReassignClick=function(){alert("Order #"+a.selectedOrder.WONUM+" has been successfully re-assgned.")};a.sortBy=function(b){a.table.sortby==b?a.table.sortdesc=!a.table.sortdesc:(a.table.sortby=b,a.table.sortdesc=!1);h()};a.isSortBy=function(b){return b==a.table.sortby?a.table.sortdesc?"sorting_desc":
"sorting_asc":"sorting"};a.onExportSelected=function(){alert("TBD")};a.formatDate=function(a){return(a=Date.parse(a))?a.toString("MM/dd/yyyy"):"n//a"};g.setWindowTitle("Work Orders");(function(){a.isLoading=!0;a.isDataAvailable=!1;f().then(function(a){h()},function(){a.isLoading=!1;a.openModalWindow("error","For some reason we couldn't load dictionaries. Try refreshing your browser.")})})()}])})(angular,Cric);(function(h,f){f.directive("cricHtmlContent",[function(){return{restrict:"A",link:function(a,e,c){a.$watch(c.ngModel,function(a){a&&e.append(a)})}}}])})(angular,CricAdmin);(function(h,f){f.directive("cricMessageEditor",[function(){return{restrict:"A",link:function(a,e,c){e.wysihtml5({html:!0,color:!0,link:!1,image:!1,stylesheets:["app/css/wysiwyg/wysiwyg-color.css"],customTemplates:{html:function(c,b){var e="<li class='dropdown'><a class='btn dropdown-toggle' data-toggle='dropdown' href='#'><span>Attribute</span>&nbsp;<b class='caret'></b></a><ul class='dropdown-menu'>",l;for(l in a.sources[a.selectedMessage.sourceid].attributes)e=e+"<li><a data-wysihtml5-command='insertHTML' data-wysihtml5-command-value='<b>{"+
l+"}</b>' tabindex='-1'>"+a.sources[a.selectedMessage.sourceid].attributes[l]+"</a></li>";return e+"</ul></li>"}},events:{blur:function(){a[c.message].messagebody=this.getValue()},load:function(){a.$watch(c.ngModel,function(){e.data("wysihtml5").editor.setValue(a[c.message].messagebody)})}}})}}}])})(angular,CricAdmin);(function(h,f){f.directive("cricAlert",function(){return{restrict:"A",link:function(a,e,c){a.$on("showAlert",function(a,b){e.append('<div class="alert alert-block '+("error"==b.type?"alert-error":"")+' fade in"><button type="button" class="close" data-dismiss="alert">\u00d7</button><strong>'+b.title+"</strong> "+b.message+"</div>");e.find(".alert").alert().delay(c.delay||1E3).fadeOut("slow")})}}})})(angular,CricBase);(function(h,f){f.directive("cricCarusel",function(){return{restrict:"A",link:function(a,e,c){e.carousel({interval:!1})}}})})(angular,CricBase);(function(h,f){f.directive("cricColorpickerInline",["$timeout",function(a){return{restrict:"A",link:function(e,c,d){var b;e.$on("destroy",function(){b&&b.simplecolorpicker("destroy")});a(function(){b=c.simplecolorpicker().on("change",function(){for(var a=e,b=c.val(),k=d.model.split(".");1<k.length;)a=a[k.shift()];a[k.shift()]=b})},0)}}}])})(angular,CricBase);(function(h,f){f.directive("cricDateRangePicker",function(){return{restrict:"A",scope:{start:"=",end:"=",format:"@"},template:'<div id="daterange" class="daterange pull-right btn btn-group"><i class="icon-calendar icon-large"></i><span title="Start Date">{{ start.toString(format) }} - {{ end.toString(format) }}</span><b class="caret"></b></div>',link:function(a,e,c){e.find(".daterange").daterangepicker({ranges:{Today:["today","today"],Yesterday:["yesterday","yesterday"],"Last 7 Days":[Date.today().add({days:-6}),
"today"],"This Month":[Date.today().moveToFirstDayOfMonth(),Date.today().moveToLastDayOfMonth()],"Last Year":[Date.today().addYears(-1),Date.today()]},startDate:a.start,endDate:a.end},function(d,b){e.find(".daterange span").html(d.toString(c.format)+" - "+b.toString(c.format));a.$apply(function(){a.start=d;a.end=b})})}}})})(angular,CricBase);(function(h,f){f.directive("cricLogoff",function(){return{restrict:"A",link:function(a,e,c){$("#logoutForm").submit()}}})})(angular,CricBase);(function(h,f){f.directive("cricMultiselect",["_",function(a){return{restrict:"A",link:function(a,c,d){function b(a,b){for(var c=b.split(".");c.length&&(a=a[c.shift()]););return a}a.$watch(d.ngModel,function(){c.multiselect("rebuild")});(function(){c.multiselect({buttonClass:d.buttonClass,buttonWidth:"auto",buttonText:function(a){if(0==a.length)return d.buttonText+' <b class="caret"></b>';if(5<a.length)return a.length+' selected  <b class="caret"></b>';var b="";a.each(function(){b+=$(this).text()+
", "});return b.substr(0,b.length-2)+' <b class="caret"></b>'},onChange:function(c,l){a.$apply(function(){if(l)b(a,d.ngModel).push($(c).val());else{var k=b(a,d.ngModel).indexOf($(c).val());b(a,d.ngModel).splice(k,1)}})}}).next().find("button.multiselect").attr("title",d.title)})()}}}])})(angular,CricBase);(function(h,f){f.directive("cricPasswordValidator",[function(){return{restrict:"A",require:"ngModel",link:function(a,e,c,d){var b=e.inheritedData("$formController")[c.cricPasswordValidator];d.$parsers.push(function(a){if(a===b.$viewValue)return d.$setValidity("match",!0),a;d.$setValidity("match",!1)});b.$parsers.push(function(a){d.$setValidity("match",a===d.$viewValue);return a})}}}])})(angular,CricBase);(function(h,f){f.directive("cricPlaceholder",function(){return{restrict:"A",link:function(a,e,c){e.placeholder()}}})})(angular,CricBase);(function(h,f){f.directive("cricPopoverError",[function(){return{restrict:"A",require:"ngModel",link:function(a,e,c,d){a.$on("$destroy",function(){e.popover("destroy")});a.$watch(c.ngModel,function(a){d.$dirty&&d.$invalid?e.popover("show"):e.popover("hide")});e.popover({title:c.errorTitle,html:!0,content:e.next("."+c.cricPopoverError).html(),placement:c.errorPosition,trigger:"manual"})}}}])})(angular,CricBase);(function(h,f){f.directive("cricTooltip",function(){return{restrict:"A",link:function(a,e,c){$("body").tooltip({selector:"[rel=tooltip]",placement:"bottom"})}}})})(angular,CricBase);(function(h,f){f.directive("cricChart",["$timeout","WorkOrderService",function(a,e){return{restrict:"A",template:"<label style='position: relative;text-align: center;'>No data available</label>",link:function(a,d,b){function g(a,b){if("openwosbytrade"==a||"closedwosbytrade"==a||"emergencycallsbytrade"==a||"toohottoocold"==a||"avghrsonclosedwos"==a)d.highcharts({chart:{type:"pie"},credits:{enabled:!1},title:{text:null},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,formatter:function(){return"<b>"+
this.point.name+"</b>: "+Number(this.percentage).toFixed(1)+" %"}},showInLegend:!0}},series:[{type:"pie",name:"avghrsonclosedwos"==a?"Hrs":"WO's",data:b}]})}function l(a){var b=d.highcharts();b&&(b.destroy(),d.append("<label style='position: relative;text-align: center;'>No data available</label>"));var b=d.parent().height(),c=b/2-parseInt(d.css("line-height"));d.find("label").css("top",c);d.height(b);e.getStatistic(a).then(function(b){0<b.length&&g(a,b)})}function k(){var a=d.parent().height(),b=
a/2-parseInt(d.css("line-height"));d.find("label").css("top",b);d.height(a)}a.$on("$destroy",function(){$(window).unbind("resize",k)});$(window).bind("resize",k);a.$watch(b.widgetid,function(a,b){a&&l(a)})}}}])})(angular,Cric);(function(h,f){f.directive("cricDashboard",["$compile","_",function(a,e){return{restrict:"A",templateUrl:"app/partials/home/dashboard/dashboard.html",link:function(c,d,b){function g(a){var b=a.offsetWidth,c=a.scrollWidth;a=a.scrollLeft;var e=d.find(".dashboard-right"),g=d.find(".dashboard-left");0==a?(e.css("display","none"),g.css("display","block")):(a+b==c?g.css("display","none"):g.css("display","block"),e.css("display","block"))}function l(a){if(h){var b=d.find(".gridster-container");b.scrollTop(u+
a.pageY-q).scrollLeft(t-a.pageX+n);g(b.get(0))}}function k(a){h=!1}function f(a,b){a.animate({scrollLeft:b},10,function(){m?f(a,b):g(d.find(".gridster-container")[0])})}var h=!1,m=!1,n=0,q=0,u=0,t=0;c.$on("$destroy",function(){$("body").unbind("mousemove",l).unbind("mouseup",k)});d.find(".gridster-container").mousewheel(function(a,b){a.preventDefault();this.scrollLeft-=30*b;g(d.find(".gridster-container")[0])});d.find(".gridster-container").mousedown(function(a){var b=a.target||a.srcElement;if($(b).hasClass("gridster-container")||
$(b).is("ul"))a.preventDefault(),h=!0,n=a.pageX,q=a.pageY,u=$(this).scrollTop(),t=$(this).scrollLeft()});d.find(".dashboard-left img").mousedown(function(){m=!0;f(d.find(".gridster-container"),"+=10")}).mouseup(function(){m=!1});d.find(".dashboard-right img").mousedown(function(){m=!0;f(d.find(".gridster-container"),"-=10")}).mouseup(function(){m=!1});$("body").bind("mousemove",l).bind("mouseup",k);var v=d.find(".gridster ul").gridster({widget_margins:[10,10],widget_base_dimensions:[140,140],draggable:{handle:".handle",
stop:function(){for(var a=v.serialize(),d=0;d<c[b.widgets].length;d++)e.extend(c[b.widgets][d],a[d])}}}).data("gridster");c.$watch(b.widgets,function(b,d){if(b){var e=v;if(b){c.options={};for(var g=0;g<b.length;g++){var k=b[g];c.options[k.id]=k.options;e.add_widget($("<li>").append("<div class='handle'>"+k.title+"</div>").append(a("<div "+k.directive+" widgetid='"+k.id+"'></div>")(c)),k.size_x,k.size_y,k.col,k.row)}}}})}}}])})(angular,Cric);(function(h,f){f.directive("cricDesignReview",["$rootScope","$timeout","_",function(a,e,c){return{restrict:"A",link:function(d,b,g){function l(){b.width($(window).width())}function k(a,b){window.userCollection=n.Section.Content.CreateUserCollection();window.emptyCollection=n.Section.Content.CreateUserCollection();var c=n.Section.Content.Objects(0);for(i=1;i<=c.Count;i++){var d=c(i).Properties;for(p=1;p<=d.Count;p++)prop=d(p),prop.Name==a&&-1<b.indexOf(prop.Value)&&window.userCollection.AddItem(c(i))}eval("window['ECompViewer'].Section.Content.Objects(1) = window['userCollection']");
m.ExecuteCommand("SHOWALL");m.ExecuteCommand("ISOLATE");eval("window['ECompViewer'].Section.Content.Objects(1) = window['emptyCollection']");delete window.userCollection;delete window.emptyCollection}function f(){b.width($(window).width()-1).width($(window).width()+1)}function h(b,c,d){if("OBJECTPROPERTIES"==b&&(f(),d))for(i=1;i<=d.Count;i++)(b=d.Item(i))&&b.Name==g.assetnumfield&&a.$broadcast("designreview:objectproperties",b.Value)}d.$on("destroy",function(){n&&(m.Viewer.ExecuteCommand("EXIT"),
delete window.ECompViewer,m.detachEvent("OnUpdateUiItem",h));$(window).unbind("resize",l)});a.$on("designreview:isolateSelected",function(a,b){n&&(k("Id",c.pluck(b,"assetnum")),f())});$(window).bind("resize",l);var m=b.width(b.width()-1).get(0),n=m.ECompositeViewer;(window.ECompViewer=n)?e(function(){m.attachEvent("OnUpdateUiItem",h);n.NavigateToURL(d.fileUrl);m.Viewer.WaitForPageLoaded();f();var a=n.Commands;a("SHOWALL").Enabled=!0;a("ISOLATE").Enabled=!0;a("SEARCHBAND").Toggled=!0;a("MODELBAND").Toggled=
!0;m.ExecuteCommand("SHOWALL")},1E3):b.append($("<param name='dwffilename'></param>").val(d.fileUrl))}}}])})(angular,Cric);(function(h,f){f.directive("cricMap",["MapService",function(a){return{restrict:"A",link:function(e,c,d){function b(){c.attr("id","mapDiv_"+(new Date).getMilliseconds());var b=new esri.Map(c.attr("id"),e.options);b.addLayer(e.basemap);dojo.connect(b,"onLayersAddResult",function(a){new esri.dijit.Scalebar({map:b,scalebarUnit:"english"});dojo.connect(b,"onClick",function(a){e.$emit("onClick",a)});e.$emit("onLayersAddResult")});if(d.tooltip){var l=dojo.create("div",{"class":"tooltip",innerHTML:d.tooltip},
b.container);dojo.style(l,"position","fixed");dojo.style(l,"display","none");dojo.connect(b,"onMouseMove",function(a){var b;a.clientX||a.pageY?(b=a.clientX,a=a.clientY):(b=a.clientX+dojo.body().scrollLeft-dojo.body().clientLeft,a=a.clientY+dojo.body().scrollTop-dojo.body().clientTop);l.style.display="none";dojo.style(l,{left:b+15+"px",top:a+"px"});l.style.display=""});dojo.connect(b,"onMouseOut",function(a){l.style.display="none"})}b.addLayers(e.layers);a.setMap(b)}e.$on("$destroy",function(){a.getMap().destroy()});
e.$watch("isLoading",function(a,c){!1===a&&b()})}}}])})(angular,Cric);(function(h,f){f.directive("cricMenuIframe",function(){return{restrict:"A",template:'<iframe src="javascript:false;" frameBorder="0" scrolling="no" allowtransparency="true"></iframe>',replace:!0,link:function(a,e,c){function d(){var a=$(".dropdown-menu",$(this).parent());a.is(":visible")||setTimeout(function(){e.css({left:void 0!=a?a.offset().left:0,width:void 0!=a?a.get(0).offsetWidth:0,height:void 0!=a?a.get(0).offsetHeight:0,display:void 0!=a?a.css("display"):"none"})},10)}a.$on("$destroy",function(){$(".nav > .dropdown > a.dropdown-toggle").unbind("click",
d)});$(".nav > .dropdown > a.dropdown-toggle").bind("click",d)}}})})(angular,Cric);(function(h,f){f.directive("cricPanelBottom",["$rootScope",function(a){return{restrict:"A",transclude:!0,scope:{pageheight:"="},template:'<div class="theme panel-bottom-link" title="Click to open pane"><i class="panel-bottom-link-arrow-up icon-chevron-up icon-white"></i></div><div style="width: 100%; background-color: #ffffff;" class="panel-container bottom" ng-transclude><i title="Click to close pane" class="panel-bottom-link-arrow-down icon-chevron-down icon-white"></i></div>',link:function(e,c,
d){function b(){c.find(".panel-container.bottom").css("width",$(".home").width());$("#"+d.iframe).hasClass("panel-bottom-link-iframe")||$("#"+d.iframe).css("height",$(".home").height())}function g(a,b){void 0!=b&&""!=b&&$("#"+b).removeClass().attr("style",d.style).addClass("panel-bottom-iframe").css("bottom",0);a.find(".panel-container.bottom").css("bottom","0px")}e.$on("$destroy",function(){e.queryContextChangedHandler();$(window).unbind("resize",b)});c.find(".panel-bottom-link-arrow-down").click(function(){e.$apply(function(){var a=
c,b=d.iframe,e=a.find(".panel-container.bottom");void 0!=b&&""!=b&&$("#"+b).css("bottom",-parseInt(e.css("height"))).removeClass().removeAttr("style").addClass("panel-bottom-link-iframe");a.find(".panel-container.bottom").css("bottom","-10000px")})});$(".panel-bottom-link").click(function(){e.$apply(function(){g(c,d.iframe)})});$(window).bind("resize",b);(function(a,b){a.find(".panel-container.bottom").css("bottom","-10000px").css("height",e.pageheight);void 0!=b&&""!=b&&$("#"+b).removeClass().addClass("panel-bottom-link-iframe")})(c,
d.iframe);e.queryContextChangedHandler=a.$on("queryContextChanged",function(a,b){"undefined"!=typeof b.results&&0<b.results.features.length&&g(c,d.iframe)});e.$watch("pageheight",function(a,b){a&&(c.find(".panel-container.bottom").css("height",a),c.find(".panel-container.bottom").trigger("heightChange"))},!0)}}}])})(angular,Cric);(function(h,f){f.directive("cricPanelContent",function(){return{restrict:"A",link:function(a,e,c){function d(a,c){var f=e.closest(".panel-content-container"),k=f.closest(".panel-container"),h=k.height()-e.position().top-parseInt(f.css("padding-top"));0<h&&e.css("height",h).css("width",f.width());c&&k.bind("heightChange",d)}a.$on("$destroy",function(){$(window).unbind("resize",d)});$(window).bind("resize",d);d(null,!0)}}})})(angular,Cric);(function(h,f){f.directive("cricPanelRight",["$rootScope",function(a){return{restrict:"A",transclude:!0,template:'<div class="theme panel-right-link" title="Click to open pane"><i class="panel-right-link-arrow-left icon-chevron-left icon-white"></i></div><div class="panel-container right" ng-transclude><i title="Click to close pane" class="panel-right-link-arrow-right icon-chevron-right icon-white"></i></div>',link:function(e,c,d){function b(){c.find(".panel-container.right").css("height",$(".home").height());
$("#"+d.iframe).hasClass("panel-right-link-iframe")||$("#"+d.iframe).css("height",$(".home").height())}function g(a,b){void 0!=b&&""!=b&&$("#"+b).removeClass().attr("style",d.style).addClass("panel-right-iframe").css("right","0");a.find(".panel-container.right").css("right","0")}(function(a,b){a.find(".panel-container.right").attr("style",d.style).css("right",-parseInt(a.css("width"))).css("display","block").css("height",$(".home").height());void 0!=b&&""!=b&&$("#"+b).removeClass().addClass("panel-right-link-iframe")})(c,
d.iframe);e.$on("$destroy",function(){e.mapOnClickHandler();$(window).unbind("resize",b)});c.find(".panel-right-link-arrow-right").click(function(){var a=d.iframe,b=c.find(".panel-container.right");void 0!=a&&""!=a&&$("#"+a).css("right",-parseInt(b.css("width"))).removeClass().removeAttr("style").addClass("panel-right-link-iframe");b.css("right",-parseInt(b.css("width")))});$(".panel-right-link").click(function(){g(c,d.iframe)});$(window).bind("resize",b);d.show&&g(c,d.iframe);e.mapOnClickHandler=
a.$on("mapOnClick",function(){g(c,d.iframe)})}}}])})(angular,Cric);(function(h,f){f.directive("cricResetStateOn",function(){return{restrict:"A",link:function(a,e,c){a.$watch(c.cricResetStateOn,function(a,b){a&&e.removeClass("active")})}}})})(angular,Cric);(function(h,f){f.directive("cricToc",[function(){return{restrict:"A",template:"<div id='{{tocid}}'></div>",link:function(a,e,c){function d(){var a=e.closest(".panel-container"),c=e.closest(".panel-content-container"),a=a.height()-c.position().top-parseInt(c.css("padding-top"))-parseInt(c.css("padding-bottom"));e.parent().css("height",a)}a.tocid=c.id+"_"+(new Date).getMilliseconds();a.$on("$destroy",function(){$(window).unbind("resize",d);dijit.byId(a.tocid).destroyRecursive()});$(window).bind("resize",
d);d()}}}])})(angular,Cric);(function(h,f){f.directive("cricWidgetAlerts",[function(){return{restrict:"A",templateUrl:"app/partials/home/dashboard/widgets/alerts.html"}}])})(angular,Cric);(function(h,f){f.directive("cricWidgetBas",[function(){return{restrict:"A",templateUrl:"app/partials/home/dashboard/widgets/bas.html"}}])})(angular,Cric);(function(h,f){f.directive("cricWidgetCalendar",[function(){return{restrict:"A",templateUrl:"app/partials/home/dashboard/widgets/calendar.html",link:function(a,e,c){a.startDate=Date.today().addYears(-1);a.endDate=Date.today()}}}])})(angular,Cric);(function(h,f){f.directive("cricWidgetChart",["$timeout","WorkOrderService",function(a,e){return{restrict:"A",template:"<label style='position: relative;text-align: center;'>No data available</label>",link:function(c,d,b){function g(a,b){if("openwosbytrade"==a||"closedwosbytrade"==a||"emergencycallsbytrade"==a||"toohottoocold"==a||"avghrsonclosedwos"==a)d.highcharts({chart:{type:"pie"},credits:{enabled:!1},title:{text:null},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,
formatter:function(){return"<b>"+this.point.name+"</b>: "+Number(this.percentage).toFixed(1)+" %"}},showInLegend:!0}},series:[{type:"pie",name:"avghrsonclosedwos"==a?"Hrs":"WO's",data:b}]})}var f=c.options[b.widgetid];a(function(){var a=d.parent().height()/2-parseInt(d.css("line-height"));d.find("label").css("top",a);e.getStatistic(f.id).then(function(a){0<a.length&&g(f.id,a)})},0)}}}])})(angular,Cric);(function(h,f){f.directive("cricWidgetCriticality",[function(){return{restrict:"A",templateUrl:"app/partials/home/dashboard/widgets/criticality.html"}}])})(angular,Cric);(function(h,f){f.directive("cricWidgetEmergency",[function(){return{restrict:"A",templateUrl:"app/partials/home/dashboard/widgets/emergency.html"}}])})(angular,Cric);(function(h,f){f.directive("cricWidgetKpm",[function(){return{restrict:"A",templateUrl:"app/partials/home/dashboard/widgets/kpm.html",link:function(a,e,c){a.startDate=Date.today().addYears(-1);a.endDate=Date.today()}}}])})(angular,Cric);(function(h,f){f.directive("cricWidgetMap",["$location","_","RequestContext","MapService",function(a,e,c,d){return{restrict:"A",templateUrl:"app/partials/home/dashboard/widgets/map.html",link:function(b,g,f){b.isLoading=!0;b.$on("onClick",function(g,f){b.$apply(function(){c.setActionContext("home.map",e.extend(c.getActionContext("home.map"),{extent:d.getMap().extent.toJson(),scale:d.getMap().getScale()}))});a.path("/home/map/toc");b.$apply()});b.$on("$destroy",function(){c.setActionContext("home.dashboard.map",
{extent:d.getMap().extent.toJson(),scale:d.getMap().getScale()})});b.actionContext=c.getActionContext("home.dashboard.map");(function(){b.isLoading=!0;d.getConfig().then(function(a){b.basemap=new esri.layers.ArcGISTiledMapServiceLayer(a.basemap);for(var c=[],d=0;d<a.layers.length;d++){var g=a.layers[d];c.push(new esri.layers.ArcGISDynamicMapServiceLayer(g.url,{id:g.id,opacity:g.opacity}))}b.layers=c;b.options=e.merge(a.options,{extent:new esri.geometry.Extent(b.actionContext.extent||a.initialExtent),
scale:b.actionContext.scale||a.options.scale});b.isLoading=!1})})()}}}])})(angular,Cric);(function(h,f){f.directive("cricWidgetReports",[function(){return{restrict:"A",templateUrl:"app/partials/home/dashboard/widgets/reports.html"}}])})(angular,Cric);(function(h,f){f.directive("cricWidgetScada",[function(){return{restrict:"A",templateUrl:"app/partials/home/dashboard/widgets/scada.html",link:function(a,e,c){a.startDate=Date.today().addYears(-1);a.endDate=Date.today()}}}])})(angular,Cric);(function(h,f){f.directive("cricWidgetWeather",[function(){return{restrict:"A",scope:!0,link:function(a,e,c){e.weatherfeed(a.options[c.widgetid].locations,a.options[c.widgetid])}}}])})(angular,Cric);(function(h,f){f.directive("cricWidgetWorkOrder",["$q","_","UserService","WorkOrderService",function(a,e,c,d){return{restrict:"A",scope:!0,templateUrl:"app/partials/home/dashboard/widgets/workorder.html",link:function(b,g,f){function h(){b.statuses=[];b.selectedStatuses=[];b.areas=[];return a.all([d.getStatuses().then(function(a){b.statuses=a;b.selectedStatuses.length||(b.selectedStatuses=e.keys(b.statuses))}),d.getAreas().then(function(a){b.areas=a;b.selectedAreas.length||(b.selectedAreas=e.keys(b.areas))}),
d.getTypes().then(function(a){b.types=a;b.selectedTypes.length||(b.selectedTypes=e.keys(b.types))}),c.getUserProfile().then(function(a){b.colors=a.colors})])}function r(){b.isLoading=!0;b.isDataAvailable=!1;b.pageIndex=1;b.orders=null;b.selectedOrder=null;d.getWorkOrders([{name:"Status",values:b.selectedStatuses},{name:"Type",values:b.selectedTypes},{name:"Area",values:b.selectedAreas},{isdate:!0,name:"EndDate",values:[b.dateRange.start.toString("MMddyyyy"),b.dateRange.end.toString("MMddyyyy")]}],
{sortby:b.table.sortby,sortdesc:b.table.sortdesc}).then(function(a){for(var c=b,d=b.table.size,f=[],g=[],h=0;h<a.length;h++){var l=e.extend(a[h],{_number:h+1,_selected:!1});g.length>=d&&(f.push(g),g=[]);g.push(l)}g.length<=d&&f.push(g);c.orders=f;b.selectedOrder=b.orders[0][0];b.isDataAvailable=0<a.length;b.isLoading=!1},function(){b.isLoading=!1;b.openModalWindow("error","For some reason we couldn't get work orders information. Try refreshing your browser.")})}b.isLoading=!0;b.isDataAvailable=!1;
b.pageIndex=1;b.orders=null;b.selectedOrder=null;b.statuses=[];b.types=[];b.areas=[];b.colors={};b.selectedStatuses=b.options[f.widgetid].statuses;b.selectedTypes=b.options[f.widgetid].types;b.selectedAreas=b.options[f.widgetid].areas;b.dateRange={start:Date.parse(b.options[f.widgetid].startDate)||Date.today().addYears(-1),end:Date.parse(b.options[f.widgetid].endDate)||Date.today()};b.table={size:6,sortby:"assetnum",sortdesc:!1};b.onPageSizeChanged=function(){r()};b.onSlide=function(a){b.pageIndex=
"prev"==a?1==b.pageIndex?b.orders.length:b.pageIndex-1:b.pageIndex==b.orders.length?1:b.pageIndex+1};b.onSelectWorkOrder=function(a){b.selectedOrder=a};b.onSearchClick=function(){r()};b.onResetClick=function(){b.table.assetnum="";b.table.wonum="";h()};b.sortBy=function(a){b.table.sortby==a?b.table.sortdesc=!b.table.sortdesc:(b.table.sortby=a,b.table.sortdesc=!1);r()};b.isSortBy=function(a){return a==b.table.sortby?b.table.sortdesc?"sorting_desc":"sorting_asc":"sorting"};b.formatDate=function(a){return(a=
Date.parse(a))?a.toString("MM/dd/yyyy"):"n//a"};b.isOverdue=function(a){var b=Date.parse(a.EndDate);return Date.now()>b&&-1<["ACT","PEN"].indexOf(a.Status)};(function(){b.isLoading=!0;b.isDataAvailable=!1;h().then(function(a){r()},function(){b.isLoading=!1;b.openModalWindow("error","For some reason we couldn't load dictionaries. Try refreshing your browser.")})})()}}}])})(angular,Cric);(function(h,f){f.filter("boolean",[function(){return function(a){return a?"Yes":"No"}}])})(angular,CricBase);(function(h,f){f.service("NotificationService",["$http","$q","_",function(a,e,c){function d(a,b,d){a=c.filter(a,function(a){for(var d=!0,e=0;e<b.length;e++){var f=b[e];0<f.values.length&&(d=d&&c.contains(f.values,a[f.name]));if(!d)break}return d});return d.sortdesc?c.sortBy(a,d.sortby).reverse():c.sortBy(a,d.sortby)}function b(a,b,d){return c.map(a,function(a){var e={};c.each(a,function(a,c){(c=b[c])&&(e[c]=d?d(c,a):a)});return e})}function g(a,b){return-1<["messageid","eventid","sourceid"].indexOf(a)?
b.toString():b}function f(a,b){return-1<["messageid","eventid","sourceid"].indexOf(a)?parseInt(b)||null:b}function k(d){var g=e.defer();a.put("api/notifications/"+d.messageid,b([d],c.invert(s),f)[0]).then(function(a){g.resolve()},function(){g.reject()});return g.promise}function r(d){var h=e.defer();a.post("api/notifications",b([d],c.invert(s),f)[0]).then(function(a){m.push(b([a.data],s,g)[0]);h.resolve()},function(){h.reject()});return h.promise}var s={MessageId:"messageid",SourceId:"sourceid",EventId:"eventid",
MessageBody:"messagebody",EventName:"eventname",SourceName:"sourcename"},m,n;return{getMessages:function(c,f,l){var k=e.defer();m&&l?k.resolve(h.copy(d(m,c,f))):a.get("api/notifications").then(function(a){m=b(a.data,s,g);k.resolve(h.copy(d(m,c,f)))},function(){k.reject()});return k.promise},saveMessage:function(a){return a.messageid?k(a):r(a)},deleteMessage:function(b){var d=e.defer();a["delete"]("api/notifications/"+b.messageid).then(function(a){m=c.without(m,c.findWithProperty(m,"messageid",b.messageid));
d.resolve()},function(){d.reject()});return d.promise},getSources:function(){var b=e.defer();n?b.resolve(h.copy(n)):a.get("api/notifications/sources").then(function(a){n={};for(var d=0;d<a.data.length;++d)n[a.data[d].SourceId]={sourcename:a.data[d].SourceName,events:c.omit(a.data[d].Events,"$id"),attributes:c.omit(a.data[d].Attributes,"$id")};b.resolve(h.copy(n))},function(){b.reject()});return b.promise}}}])})(angular,CricAdmin);(function(h,f){f.service("ApplicationSettingsService",["$http","$q","_",function(a,e,c){var d={};return{getSetting:function(b){var c=e.defer();d[b]?c.resolve(h.copy(d[b])):a.get("api/applicationsettings/"+b).then(function(a){a.data?(d[b]=h.fromJson(a.data.Value),c.resolve(h.copy(d[b]))):c.reject()},function(){c.reject()});return c.promise},getSettings:function(){var b=e.defer();0<Object.keys(d).length?b.resolve(h.copy(d)):a.get("api/applicationsettings").then(function(a){a.data?(c.forEach(a.data,
function(a){d[a.Id]=h.fromJson(a.Value||"{}")}),b.resolve(h.copy(d))):b.reject()},function(){b.reject()});return b.promise},setSetting:function(b,c){var f=e.defer();a.put("api/applicationsettings/"+b,{Value:h.toJson(c)}).then(function(a){d[b]=h.copy(c);f.resolve(h.copy(d[b]))},function(){f.reject()});return f.promise}}}])})(angular,CricBase);(function(h,f,a){f.factory("_",function(){a.findWithProperty=function(e,c,d){return a.find(e,function(a){return a[c]===d})};a.filterWithProperty=function(e,c,d){return a.filter(e,function(a){return a[c]===d})};a.endsWithProperty=function(e,c,d){return a.filter(e,function(a){return d.match(a[c]+"$")==a[c]})};return a})})(angular,CricBase,_.noConflict());(function(h,f){f.value("RenderContext",function(a,e,c){return{getNextSection:function(){return a.getNextSection(e)},isChangeLocal:function(){return a.startsWith(e)},isChangeRelevant:function(){return!a.startsWith(e)?!1:a.hasActionChanged()?!0:c.length&&a.haveParamsChanged(c)}}})})(angular,CricBase);(function(h,f){f.service("RequestContext",["_","RenderContext",function(a,e){function c(a,b){return!h.isUndefined(b)?!d(a,b):!s.hasOwnProperty(a)&&k.hasOwnProperty(a)||s.hasOwnProperty(a)&&!k.hasOwnProperty(a)?!0:s[a]!==k[a]}function d(a,b){return k.hasOwnProperty(a)&&k[a]==b?!0:!1}function b(a){return!a.length||f===a||0===f.indexOf(a+".")?!0:!1}var f="",l=[],k={},r="",s={},m={};return{getNextSection:function(a){if(!b(a))return null;if(""===a)return l[0];a=a.split(".").length;return a===l.length?
null:l[a]},getParam:function(a,b){h.isUndefined(b)&&(b=null);return k[a]||b},getParamAsInt:function(a,b){var c=1*this.getParam(a,b||0);return isNaN(c)?b||0:c},getRenderContext:function(a,b){a=a||"";b=b||[];h.isArray(b)||(b=[b]);return new e(this,a,b)},hasActionChanged:function(){return f!==r},hasParamChanged:c,haveParamsChanged:function(a){for(var b=0,d=a.length;b<d;b++)if(c(a[b]))return!0;return!1},isParam:d,setContext:function(a,b){r=f;s=k;f=a;l=f.split(".");k=h.copy(b)},setWindowTitle:function(a){window.document.title=
"CRIC - "+a},setActionContext:function(a,b){m[a]=h.copy(b)},getActionContext:function(a){return m[a]||{}},startsWith:b}}])})(angular,CricBase);(function(h,f){f.service("UserService",["$http","$q","_","ApplicationSettingsService",function(a,e,c,d){function b(a,b,d){a=c.filter(a,function(a){for(var d=!0,e=0;e<b.length;e++){var f=b[e];0<f.values.length&&(d=c.isArray(a[f.name])?d&&0<c.intersection(f.values,a[f.name]).length:d&&c.contains(f.values,a[f.name]));if(!d)break}return d});return d.sortdesc?c.sortBy(a,d.sortby).reverse():c.sortBy(a,d.sortby)}function f(a,b,d){return c.map(a,function(a){var e={};c.each(a,function(a,c){(c=b[c])&&(e[c]=
d?d(c,a):a)});return e})}function l(a,b){return-1<["colors","widgets","bookmarks"].indexOf(a)?h.fromJson(b||[]):b}function k(a,b){return-1<["Colors","Widgets","Bookmarks"].indexOf(a)?b?h.toJson(b):b:b}function r(b){var d=e.defer();a.put("api/users/"+b.userid,f([b],c.invert(m),k)[0]).then(function(a){d.resolve()},function(){d.reject()});return d.promise}function s(b){var d=e.defer();a.post("api/users",f([b],c.invert(m),k)[0]).then(function(a){q.push(f([a.data],m,l)[0]);d.resolve()},function(a){d.reject(a)});
return d.promise}var m={UserId:"userid",UserName:"username",FullName:"fullname",Email:"email",Widgets:"widgets",Colors:"colors",Bookmarks:"bookmarks",Roles:"roles",Password:"password",Disabled:"disabled"},n,q,u;return{getUserProfile:function(){var b=e.defer();n?b.resolve(h.copy(n)):d.getSetting("colors").then(function(c){a.get("api/users/current").then(function(a){if(a.data){n=f([a.data],m,l)[0];if(!n.colors||0==n.colors.length)n.colors=c;b.resolve(h.copy(n))}else b.reject()},function(){b.reject()})},
function(){console.log("We couldn't load the application settings.")});return b.promise},setUserProfile:function(b){var d=e.defer();a.put("api/users/current",f([b],c.invert(m),k)[0]).then(function(a){n=h.copy(b);d.resolve(n)},function(){d.reject()});return d.promise},getUsers:function(c,d,k){var n=e.defer();q&&k?n.resolve(h.copy(b(q,c,d))):a.get("api/users").then(function(a){q=f(a.data,m,l);n.resolve(h.copy(b(q,c,d)))},function(){n.reject()});return n.promise},saveUser:function(a){return a.userid?
r(a):s(a)},resetPassword:function(b){var c=e.defer();a.get("api/users/"+b.userid+"/resetpassword").then(function(a){c.resolve()},function(){c.reject()});return c.promise},deleteUser:function(b){var d=e.defer();a["delete"]("api/users/"+b.userid).then(function(a){q=c.without(q,c.findWithProperty(q,"userid",b.userid));d.resolve()},function(){d.reject()});return d.promise},getRoles:function(){var b=e.defer();u?b.resolve(h.copy(u)):a.get("api/users/roles").then(function(a){u={};for(var c=0;c<a.data.length;++c)u[a.data[c]]=
a.data[c];b.resolve(h.copy(u))},function(){b.reject()});return b.promise}}}])})(angular,CricBase);(function(h,f){f.service("MapService",["$rootScope","$http","$q","$timeout","_",function(a,e,c,d,b){function f(a){var c=b.find(m,function(b){return b.mapid==a.mapid&&b.layerid==a.layerId});return c?(b.findWithProperty(c.features,"id",a.feature.attributes[c.fieldname])||{}).files||[]:[]}function l(a){if(r&&r.graphics){var c=b.filter(r.graphics.graphics,function(c){return-1<b.indexOf(a,c.type)});b.forEach(c,function(a){r.graphics.remove(a)})}}function k(){return q||{}}var r=null,s=null,m=null,n={},
q=null,u=null,t=!0;return{setMap:function(a){r=a},getMap:function(){return r},enableOnClick:function(){t=!0},disableOnClick:function(){t=!1},isOnClick:function(){return t},setOnClickEvent:function(a){u=a},getOnClickEvent:function(){return u},getConfig:function(){var a=c.defer();s?a.resolve(h.copy(s)):e.get("api/map/config").then(function(b){s=b.data;a.resolve(h.copy(s))},function(){a.reject()});return a.promise},getLayers:function(a,d){var f=c.defer();n[a]?f.resolve(h.copy(n[a])):(a+="/layers",esri.config.defaults.io.alwaysUseProxy&&
(a=esri.config.defaults.io.proxyUrl+"?"+a),e.get(a+"?f=json").then(function(c){b.extend(c,{mapid:d});n[a]=c;f.resolve(h.copy(n[a]))},function(){f.reject()}));return f.promise},waitForLayers:function(a){var b=c.defer();if(r)if(r.loaded)b.resolve();else var d=dojo.connect(r,"onLayersAddResult",function(c){a.$apply(function(){dojo.disconnect(d);b.resolve()})});else b.reject();return b.promise},clearGraphics:l,hasGraphics:function(a){return r&&r.graphics?0<b.filter(r.graphics.graphics,function(c){return-1<
b.indexOf(a,c.type)}).length:!1},setQueryContext:function(b,c,d){var e=k();e.results?(q.results.features=e.results.features.concat(b.features),q.results.extent=e.results.extent?e.results.extent.union(d):d):q={layer:c,results:{features:b.features,fieldAliases:b.fieldAliases,fields:b.fields,extent:d}};a.$broadcast("queryContextChanged",k())},getQueryContext:k,clearQueryContext:function(){l(["query","highlight"]);q&&(q=null)},getFeatureAttachments:function(a){var b=c.defer();m?b.resolve(h.copy(f(a))):
e.get("api/map/attachments").then(function(c){m=c.data;b.resolve(h.copy(f(a)))},function(){b.reject()});return b.promise},getFeaturesData:function(a,f){var g=c.defer(),h=[];b.forEach(a.features,function(a){h.push(a.attributes[f.keyname])});f.resource?e.get(f.resource).then(function(c){if(c.data&&0<c.data.length){var d=b.findWithProperty(b.findWithProperty(s.layers,"id",f.mapid).layerInfos,"id",f.layerid),e=Object.keys(c.data[0]);b.forEach(e,function(a){a!=f.keyname&&b.contains(d.fields,a)&&f.fields.push(new esri.layers.Field({name:a,
alias:a,length:256,type:"esriFieldTypeString"}))});f.fields=b.sortBy(f.fields,"alias");b.forEach(a.features,function(a){b.extend(a.attributes,b.findWithProperty(c.data,f.keyname,a.attributes[f.keyname]))})}g.resolve({results:a,layer:f})},function(){g.reject()}):d(function(){g.resolve({results:a,layer:f})},0);return g.promise}}}])})(angular,Cric);(function(h,f){f.service("WorkOrderService",["$http","$q","_","TradeColors",function(a,e,c,d){function b(a,b,d){a=c.filter(a,function(a){for(var d=!0,e=0;e<b.length;e++){var f=b[e];if(f.regexp)d=d&&f.regexp.test(a[f.name]);else if(0<f.values.length)if(f.isdate)var g=Date.parse(a[f.name]),d=d&&g.between(Date.parse(f.values[0]),Date.parse(f.values[1]));else 0<f.values.length&&(d=d&&c.contains(f.values,a[f.name]));if(!d)break}return d});return d?d.sortdesc?c.sortBy(a,d.sortby).reverse():c.sortBy(a,d.sortby):
a}function f(c,d){var g=e.defer();m?g.resolve(b(h.copy(m),c,d)):a.get("api/workorders").then(function(a){m=a.data;g.resolve(b(h.copy(m),c,d))},function(){g.reject()});return g.promise}function l(){return Date.parse("05/15/2013")}function k(a){var b=e.defer();e.all([s(),f(a).then(function(a){var e={};c.each(a,function(a){var b=e[a.Trade];b?(b.count++,b.value+=parseFloat(a["Labor Hrs"])||0):e[a.Trade]={count:1,value:parseFloat(a["Labor Hrs"])||0}});var f=[];c.each(c.keys(e),function(a){f.push({name:w[a],
y:e[a].value/e[a].count,sliced:"HV"==a,selected:"HV"==a,color:d[a]})});b.resolve(f)},function(){b.reject()})]);return b.promise}function r(a){var b=e.defer();e.all([s(),f(a).then(function(a){var e=[];c.each(c.keys(w),function(b){var f=c.filterWithProperty(a,"Trade",b).length;0<f&&e.push({name:w[b],y:f,sliced:"HV"==b,selected:"HV"==b,color:d[b]})});b.resolve(e)},function(){b.reject()})]);return b.promise}function s(){var b=e.defer();w?b.resolve(h.copy(w)):a.get("api/workorders/trades").then(function(a){w=
a.data;b.resolve(h.copy(w))},function(){b.reject()});return b.promise}var m,n,q,u,t,v,x,w;return{getTypes:function(){var b=e.defer();n?b.resolve(h.copy(n)):a.get("api/workorders/types").then(function(a){n=a.data;b.resolve(h.copy(n))},function(){b.reject()});return b.promise},getSystems:function(){var b=e.defer();q?b.resolve(h.copy(q)):a.get("api/workorders/systems").then(function(a){q=a.data;b.resolve(h.copy(q))},function(){b.reject()});return b.promise},getBuildings:function(){var b=e.defer();t?
b.resolve(h.copy(t)):a.get("api/workorders/buildings").then(function(a){t=a.data;b.resolve(h.copy(t))},function(){b.reject()});return b.promise},getPriorities:function(){var b=e.defer();u?b.resolve(h.copy(u)):a.get("api/workorders/priorities").then(function(a){u=a.data;b.resolve(h.copy(u))},function(){b.reject()});return b.promise},getStatuses:function(){var b=e.defer();v?b.resolve(h.copy(v)):a.get("api/workorders/statuses").then(function(a){v=a.data;b.resolve(h.copy(v))},function(){b.reject()});
return b.promise},getAreas:function(){var b=e.defer();x?b.resolve(h.copy(x)):a.get("api/workorders/areas").then(function(a){x=a.data;b.resolve(h.copy(x))},function(){b.reject()});return b.promise},getTrades:s,getWorkOrders:f,getStatistic:function(a){if("openwosbytrade"==a)return r([{isdate:!0,name:"StartDate",values:[l().moveToFirstDayOfMonth(),l().moveToLastDayOfMonth()]},{name:"Status",values:["OPEN"]}]);if("emergencycallsbytrade"==a)return r([{isdate:!0,name:"StartDate",values:[l().moveToFirstDayOfMonth(),
l().moveToLastDayOfMonth()]},{name:"Type",values:["CM","EM"]}]);if("avghrsonclosedwos"==a)return k([{isdate:!0,name:"StartDate",values:[l().clearTime().moveToFirstDayOfMonth().add(-1).months(),l().clearTime().moveToLastDayOfMonth().add(-1).months()]},{name:"Status",values:["CLOSED"]}]);if("closedwosbytrade"==a)return r([{isdate:!0,name:"StartDate",values:[l().clearTime().moveToFirstDayOfMonth().add(-1).months(),l().clearTime().moveToLastDayOfMonth().add(-1).months()]},{name:"Status",values:["CLOSED"]}]);
if("toohottoocold"==a)return r([{isdate:!0,name:"StartDate",values:[l().moveToFirstDayOfMonth(),l().moveToLastDayOfMonth()]},{name:"Status",values:["OPEN"]},{regexp:/too[\s]+(cold|hot)/im,name:"Description"}])}}}])})(angular,Cric);
